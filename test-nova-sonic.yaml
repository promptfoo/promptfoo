# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: Test Nova Sonic as target with OpenAI simulated user

prompts:
  - |
    You are a friendly customer service agent for a coffee shop.
    Help customers with their orders.
    Be brief and conversational.
    Speak naturally as if on a phone call.

providers:
  - id: promptfoo:simulated-voice-user
    config:
      instructions: "{{goal}}"
      maxTurns: 5
      timeoutMs: 120000
      # Target: Nova Sonic (what we're testing)
      targetProvider: bedrock
      targetModel: amazon.nova-sonic-v1:0
      targetVoice: tiffany
      # Nova Sonic requires simulated user to speak first
      # because it uses VAD and can't initiate without audio input
      targetSpeaksFirst: false
      # Simulated User: OpenAI Realtime
      simulatedUserProvider: openai
      simulatedUserModel: gpt-4o-realtime-preview
      simulatedUserVoice: echo
      # Audio settings
      audioFormat: pcm16
      sampleRate: 24000
      turnDetectionMode: server_vad
      silenceThresholdMs: 500

tests:
  - vars:
      goal: |
        You are a customer calling to order a coffee.
        Ask for a medium latte with oat milk.
        Confirm the order and say goodbye.
        Say "###STOP###" when the order is confirmed.
    assert:
      - type: icontains
        value: latte
      - type: llm-rubric
        value: |
          The customer should have successfully ordered a latte.
          The agent should have been helpful and friendly.
          Was the order confirmed?

outputPath: test-nova-sonic-output.json
