services:
  promptfoo-test:
    build:
      context: .
      dockerfile: Dockerfile.cross-platform
    container_name: promptfoo-test-env
    volumes:
      - .:/app:rw
      - node_modules:/app/node_modules
    ports:
      - '3000:3000'
      - '8080:8080'
    environment:
      - NODE_ENV=development
      - PROMPTFOO_DISABLE_SHARING=true
      - LANG=en_US.UTF-8
      - LC_ALL=en_US.UTF-8
    working_dir: /app
    command: npm run dev
    stdin_open: true
    tty: true

  # Service for running Unicode tests specifically
  promptfoo-unicode-test:
    build:
      context: .
      dockerfile: Dockerfile.cross-platform
    container_name: promptfoo-unicode-test
    volumes:
      - .:/app:rw
      - node_modules:/app/node_modules
    environment:
      - NODE_ENV=test
      - PROMPTFOO_DISABLE_SHARING=true
      - LANG=en_US.UTF-8
      - LC_ALL=en_US.UTF-8
    working_dir: /app
    command: npm test -- test/providers/pythonCompletion.unicode.test.ts --testTimeout=30000 --verbose
    stdin_open: true
    tty: true

  # Service for running Claude Code
  promptfoo-claude:
    build:
      context: .
      dockerfile: Dockerfile.cross-platform
    container_name: promptfoo-claude
    volumes:
      - .:/app:rw
      - node_modules:/app/node_modules
    environment:
      - NODE_ENV=development
      - PROMPTFOO_DISABLE_SHARING=true
      - LANG=en_US.UTF-8
      - LC_ALL=en_US.UTF-8
    working_dir: /app
    command: claude-code
    stdin_open: true
    tty: true
    ports:
      - '3001:3000'

  # Service with Wine for actual Windows simulation (experimental)
  promptfoo-wine:
    build:
      context: .
      dockerfile: Dockerfile.wine
    container_name: promptfoo-wine
    volumes:
      - .:/app:rw
    environment:
      - DISPLAY=:0
      - WINEDLLOVERRIDES=mscoree,mshtml=
    working_dir: /app
    stdin_open: true
    tty: true
    profiles:
      - wine

volumes:
  node_modules:
