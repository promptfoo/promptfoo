# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: Test Nova Sonic adapter - both target and simulated user

prompts:
  - |
    You are a friendly customer service agent for a coffee shop.
    Help customers with their orders.
    Be brief and conversational.
    Speak naturally as if on a phone call.

providers:
  - id: promptfoo:simulated-voice-user
    config:
      instructions: "{{goal}}"
      maxTurns: 5
      timeoutMs: 120000
      # Target: Nova Sonic
      targetProvider: bedrock
      targetModel: amazon.nova-sonic-v1:0
      targetVoice: tiffany
      # Simulated User: Also Nova Sonic (to test without OpenAI key)
      simulatedUserProvider: bedrock
      simulatedUserModel: amazon.nova-sonic-v1:0
      simulatedUserVoice: matthew
      # Audio settings
      audioFormat: pcm16
      sampleRate: 24000
      turnDetectionMode: server_vad
      silenceThresholdMs: 500

tests:
  - vars:
      goal: |
        You are a customer calling to order a coffee.
        Ask for a medium latte with oat milk.
        Confirm the order and say goodbye.
        Say "###STOP###" when the order is confirmed.
    assert:
      - type: icontains
        value: latte

outputPath: test-nova-sonic-both-output.json
