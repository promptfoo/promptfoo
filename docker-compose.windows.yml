version: '3.8'

services:
  promptfoo-windows:
    build:
      context: .
      dockerfile: Dockerfile.windows
    container_name: promptfoo-windows-dev
    volumes:
      # Mount source code for development
      - .:/app:rw
      # Mount node_modules as volume to avoid permission issues
      - node_modules:/app/node_modules
    ports:
      - '3000:3000'
      - '8080:8080'
    environment:
      - NODE_ENV=development
      - PROMPTFOO_DISABLE_SHARING=true
    working_dir: /app
    command: powershell -Command "npm run dev"
    stdin_open: true
    tty: true

  # Alternative service for running tests specifically
  promptfoo-windows-test:
    build:
      context: .
      dockerfile: Dockerfile.windows
    container_name: promptfoo-windows-test
    volumes:
      - .:/app:rw
      - node_modules:/app/node_modules
    environment:
      - NODE_ENV=test
      - PROMPTFOO_DISABLE_SHARING=true
    working_dir: /app
    command: powershell -Command "npm test -- test/providers/pythonCompletion.unicode.test.ts"
    stdin_open: true
    tty: true

  # Service for running Claude Code
  promptfoo-windows-claude:
    build:
      context: .
      dockerfile: Dockerfile.windows
    container_name: promptfoo-windows-claude
    volumes:
      - .:/app:rw
      - node_modules:/app/node_modules
    environment:
      - NODE_ENV=development
      - PROMPTFOO_DISABLE_SHARING=true
    working_dir: /app
    command: powershell -Command "claude-code"
    stdin_open: true
    tty: true
    ports:
      - '3001:3000'

volumes:
  node_modules:
