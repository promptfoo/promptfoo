<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ config.description | default('Evaluation Results') }} - Promptfoo</title>
    <style>
      /* ========================================
         CSS Variables - Design Tokens
         ======================================== */
      :root {
        /* Colors - Light Mode */
        --bg-primary: #ffffff;
        --bg-secondary: #f8fafc;
        --bg-tertiary: #f1f5f9;
        --border-color: #e2e8f0;
        --border-color-strong: #cbd5e1;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --text-muted: #94a3b8;

        /* Status Colors */
        --pass-bg: #ecfdf5;
        --pass-text: #065f46;
        --pass-border: #a7f3d0;
        --fail-bg: #fef2f2;
        --fail-text: #991b1b;
        --fail-border: #fecaca;
        --error-bg: #fffbeb;
        --error-text: #92400e;
        --error-border: #fde68a;

        /* Accent Colors */
        --accent-blue: #3b82f6;
        --accent-blue-light: #eff6ff;

        /* Typography */
        --font-sans:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        --font-mono: 'SF Mono', Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;

        /* Spacing */
        --spacing-1: 0.25rem;
        --spacing-2: 0.5rem;
        --spacing-3: 0.75rem;
        --spacing-4: 1rem;
        --spacing-6: 1.5rem;
        --spacing-8: 2rem;

        /* Borders */
        --radius-sm: 0.25rem;
        --radius-md: 0.375rem;
        --radius-lg: 0.5rem;

        /* Shadows */
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      }

      /* Dark Mode - Screen Only */
      @media screen and (prefers-color-scheme: dark) {
        :root {
          --bg-primary: #0f172a;
          --bg-secondary: #1e293b;
          --bg-tertiary: #334155;
          --border-color: #334155;
          --border-color-strong: #475569;
          --text-primary: #f1f5f9;
          --text-secondary: #94a3b8;
          --text-muted: #64748b;

          --pass-bg: rgba(6, 95, 70, 0.3);
          --pass-text: #6ee7b7;
          --pass-border: #065f46;
          --fail-bg: rgba(153, 27, 27, 0.3);
          --fail-text: #fca5a5;
          --fail-border: #991b1b;
          --error-bg: rgba(180, 83, 9, 0.3);
          --error-text: #fcd34d;
          --error-border: #b45309;

          --accent-blue-light: rgba(59, 130, 246, 0.2);

          --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
          --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4), 0 2px 4px -2px rgb(0 0 0 / 0.3);
        }
      }

      /* ========================================
         Print Styles
         ======================================== */
      @media print {
        :root {
          --bg-primary: #ffffff;
          --bg-secondary: #ffffff;
          --bg-tertiary: #f8fafc;
          --border-color: #cbd5e1;
          --border-color-strong: #94a3b8;
          --text-primary: #000000;
          --text-secondary: #475569;
          --text-muted: #64748b;

          --pass-bg: #d1fae5;
          --pass-text: #064e3b;
          --pass-border: #6ee7b7;
          --fail-bg: #fee2e2;
          --fail-text: #7f1d1d;
          --fail-border: #fca5a5;
          --error-bg: #fef3c7;
          --error-text: #78350f;
          --error-border: #fcd34d;

          --shadow-sm: none;
          --shadow-md: none;
        }

        @page {
          size: A4 landscape;
          margin: 1.5cm;
        }

        @page :first {
          margin-top: 1cm;
        }

        * {
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
          color-adjust: exact !important;
        }

        body {
          font-size: 9pt;
        }

        .no-print {
          display: none !important;
        }

        .print-only {
          display: block !important;
        }

        /* Force expand all details */
        details {
          display: block !important;
        }

        details > summary {
          display: none !important;
        }

        details > .content-full {
          display: block !important;
        }

        /* Page breaks */
        .summary-header {
          page-break-after: avoid;
        }

        thead {
          display: table-header-group;
        }

        tr {
          page-break-inside: avoid;
        }

        .cell {
          page-break-inside: avoid;
        }

        /* Table adjustments */
        table {
          font-size: 8pt;
        }

        th,
        td {
          padding: 4pt 6pt;
        }

        /* Limit image sizes */
        img {
          max-width: 150px !important;
          max-height: 100px !important;
        }

        /* Audio/video placeholders */
        audio,
        video {
          display: none !important;
        }

        .media-print-placeholder {
          display: block !important;
        }
      }

      /* ========================================
         Base Styles
         ======================================== */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-sans);
        font-size: 14px;
        line-height: 1.5;
        color: var(--text-primary);
        background-color: var(--bg-primary);
        margin: 0;
        padding: 0;
      }

      .print-only {
        display: none;
      }

      /* ========================================
         Summary Header
         ======================================== */
      .summary-header {
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
        padding: var(--spacing-6) var(--spacing-8);
        margin-bottom: var(--spacing-6);
      }

      .summary-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0 0 var(--spacing-2) 0;
        color: var(--text-primary);
      }

      .summary-meta {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: var(--spacing-4);
      }

      .summary-stats {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-4);
        margin-top: var(--spacing-4);
      }

      .stat-card {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: var(--spacing-3) var(--spacing-4);
        min-width: 100px;
        text-align: center;
        box-shadow: var(--shadow-sm);
      }

      .stat-card.pass {
        border-color: var(--pass-border);
        background: var(--pass-bg);
      }

      .stat-card.fail {
        border-color: var(--fail-border);
        background: var(--fail-bg);
      }

      .stat-card.error {
        border-color: var(--error-border);
        background: var(--error-bg);
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        line-height: 1.2;
      }

      .stat-card.pass .stat-value {
        color: var(--pass-text);
      }
      .stat-card.fail .stat-value {
        color: var(--fail-text);
      }
      .stat-card.error .stat-value {
        color: var(--error-text);
      }

      .stat-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-secondary);
        margin-top: var(--spacing-1);
      }

      /* ========================================
         Table Container
         ======================================== */
      .table-container {
        padding: 0 var(--spacing-4);
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.875rem;
      }

      /* ========================================
         Table Header
         ======================================== */
      thead {
        background: var(--bg-secondary);
        position: sticky;
        top: 0;
        z-index: 10;
      }

      th {
        padding: var(--spacing-3) var(--spacing-4);
        text-align: left;
        font-weight: 600;
        color: var(--text-primary);
        border-bottom: 2px solid var(--border-color-strong);
        white-space: nowrap;
      }

      th.var-col {
        background: var(--bg-tertiary);
        min-width: 150px;
      }

      th.output-col {
        min-width: 300px;
      }

      /* ========================================
         Table Body
         ======================================== */
      tbody tr {
        border-bottom: 1px solid var(--border-color);
      }

      tbody tr:hover {
        background: var(--bg-secondary);
      }

      tbody tr:target {
        background: var(--accent-blue-light);
        outline: 2px solid var(--accent-blue);
        outline-offset: -2px;
      }

      td {
        padding: var(--spacing-3) var(--spacing-4);
        vertical-align: top;
        border-right: 1px solid var(--border-color);
      }

      td:last-child {
        border-right: none;
      }

      td.var-cell {
        background: var(--bg-secondary);
        font-family: var(--font-mono);
        font-size: 0.8125rem;
        white-space: pre-wrap;
        word-break: break-word;
        max-width: 300px;
      }

      /* ========================================
         Output Cell
         ======================================== */
      .cell {
        min-height: 60px;
      }

      .cell-header {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: var(--spacing-2);
        margin-bottom: var(--spacing-2);
      }

      /* Status Badge */
      .badge {
        display: inline-flex;
        align-items: center;
        padding: var(--spacing-1) var(--spacing-2);
        font-size: 0.6875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border-radius: var(--radius-sm);
      }

      .badge.pass {
        background: var(--pass-bg);
        color: var(--pass-text);
        border: 1px solid var(--pass-border);
      }

      .badge.fail {
        background: var(--fail-bg);
        color: var(--fail-text);
        border: 1px solid var(--fail-border);
      }

      .badge.error {
        background: var(--error-bg);
        color: var(--error-text);
        border: 1px solid var(--error-border);
      }

      .score {
        font-size: 0.75rem;
        color: var(--text-secondary);
        font-weight: 500;
      }

      /* Named Scores */
      .named-scores {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-1);
        margin-bottom: var(--spacing-2);
      }

      .metric-chip {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-1);
        padding: 2px var(--spacing-2);
        font-size: 0.6875rem;
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        color: var(--text-secondary);
      }

      .metric-chip .metric-name {
        color: var(--text-muted);
      }

      .metric-chip .metric-value {
        font-weight: 600;
        color: var(--text-primary);
      }

      /* Fail/Error Reason */
      .fail-reason {
        font-size: 0.8125rem;
        padding: var(--spacing-2);
        margin-bottom: var(--spacing-2);
        background: var(--fail-bg);
        border-left: 3px solid var(--fail-border);
        border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        color: var(--fail-text);
      }

      .error-reason {
        font-size: 0.8125rem;
        padding: var(--spacing-2);
        margin-bottom: var(--spacing-2);
        background: var(--error-bg);
        border-left: 3px solid var(--error-border);
        border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        color: var(--error-text);
      }

      /* ========================================
         Content Display
         ======================================== */
      .content-wrapper {
        margin: var(--spacing-2) 0;
      }

      .content-wrapper summary {
        cursor: pointer;
        list-style: none;
        display: -webkit-box;
        -webkit-line-clamp: 4;
        -webkit-box-orient: vertical;
        overflow: hidden;
        white-space: pre-wrap;
        word-break: break-word;
        font-size: 0.875rem;
        line-height: 1.6;
        color: var(--text-primary);
      }

      .content-wrapper summary::-webkit-details-marker {
        display: none;
      }

      .content-wrapper summary::before {
        content: '+ ';
        font-weight: bold;
        color: var(--text-muted);
      }

      .content-wrapper[open] summary {
        display: none;
      }

      .content-wrapper .content-full {
        display: none;
        white-space: pre-wrap;
        word-break: break-word;
        font-size: 0.875rem;
        line-height: 1.6;
      }

      .content-wrapper[open] .content-full {
        display: block;
      }

      /* Short content (no truncation needed) */
      .content-short {
        white-space: pre-wrap;
        word-break: break-word;
        font-size: 0.875rem;
        line-height: 1.6;
      }

      /* ========================================
         Assertions List
         ======================================== */
      .assertions-wrapper {
        margin-top: var(--spacing-2);
        font-size: 0.8125rem;
      }

      .assertions-wrapper summary {
        cursor: pointer;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .assertions-wrapper summary::-webkit-details-marker {
        display: none;
      }

      .assertions-wrapper summary::before {
        content: '\25B6  ';
        font-size: 0.625rem;
      }

      .assertions-wrapper[open] summary::before {
        content: '\25BC  ';
      }

      .assertion-list {
        list-style: none;
        margin: var(--spacing-2) 0 0 0;
        padding: 0;
      }

      .assertion-list li {
        padding: var(--spacing-1) 0;
        padding-left: var(--spacing-4);
        border-left: 2px solid var(--border-color);
        margin-bottom: var(--spacing-1);
      }

      .assertion-list li.pass {
        border-left-color: var(--pass-border);
        color: var(--pass-text);
      }

      .assertion-list li.fail {
        border-left-color: var(--fail-border);
        color: var(--fail-text);
      }

      /* ========================================
         Metrics Display
         ======================================== */
      .cell-metrics {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-3);
        margin-top: var(--spacing-3);
        padding-top: var(--spacing-2);
        border-top: 1px solid var(--border-color);
        font-size: 0.75rem;
        color: var(--text-secondary);
      }

      .cell-metrics span {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-1);
      }

      /* ========================================
         Media Display
         ======================================== */
      .output-image {
        max-width: 100%;
        max-height: 300px;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-color);
        margin: var(--spacing-2) 0;
      }

      .output-audio {
        width: 100%;
        margin: var(--spacing-2) 0;
      }

      .output-video {
        max-width: 100%;
        max-height: 300px;
        border-radius: var(--radius-md);
        margin: var(--spacing-2) 0;
      }

      .media-print-placeholder {
        display: none;
        padding: var(--spacing-2);
        border: 1px dashed var(--border-color);
        border-radius: var(--radius-sm);
        font-style: italic;
        color: var(--text-secondary);
        font-size: 0.8125rem;
      }

      .transcript {
        font-size: 0.8125rem;
        color: var(--text-secondary);
        margin-top: var(--spacing-2);
        padding: var(--spacing-2);
        background: var(--bg-secondary);
        border-radius: var(--radius-sm);
      }

      .transcript strong {
        color: var(--text-primary);
      }

      /* ========================================
         Footer
         ======================================== */
      .page-footer {
        margin-top: var(--spacing-8);
        padding: var(--spacing-4) var(--spacing-8);
        border-top: 1px solid var(--border-color);
        text-align: center;
        font-size: 0.75rem;
        color: var(--text-muted);
      }

      .page-footer a {
        color: var(--accent-blue);
        text-decoration: none;
      }

      .page-footer a:hover {
        text-decoration: underline;
      }

      /* ========================================
         Responsive
         ======================================== */
      @media (max-width: 768px) {
        .summary-header {
          padding: var(--spacing-4);
        }

        .summary-stats {
          gap: var(--spacing-2);
        }

        .stat-card {
          min-width: 80px;
          padding: var(--spacing-2);
        }

        .stat-value {
          font-size: 1.25rem;
        }

        .table-container {
          padding: 0;
        }

        th,
        td {
          padding: var(--spacing-2);
        }
      }
    </style>
  </head>
  <body>
    <!-- Summary Header -->
    <header class="summary-header">
      <h1 class="summary-title">{{ config.description | default('Evaluation Results') }}</h1>
      <div class="summary-meta">
        Generated: {{ timestamp }} {% if shareableUrl %} &bull;
        <a href="{{ shareableUrl | escape }}">View in Promptfoo</a>
        {% endif %}
      </div>
      <div class="summary-stats">
        <div class="stat-card pass">
          <div class="stat-value">{{ stats.successes | default(0) }}</div>
          <div class="stat-label">Passed</div>
        </div>
        <div class="stat-card fail">
          <div class="stat-value">{{ stats.failures | default(0) }}</div>
          <div class="stat-label">Failed</div>
        </div>
        <div class="stat-card error">
          <div class="stat-value">{{ stats.errors | default(0) }}</div>
          <div class="stat-label">Errors</div>
        </div>
        {% if stats.tokenUsage and stats.tokenUsage.total %}
        <div class="stat-card">
          <div class="stat-value">{{ stats.tokenUsage.total | numberFormat }}</div>
          <div class="stat-label">Tokens</div>
        </div>
        {% endif %} {% if stats.totalCost %}
        <div class="stat-card">
          <div class="stat-value">${{ stats.totalCost | round(2) }}</div>
          <div class="stat-label">Cost</div>
        </div>
        {% endif %} {% if stats.durationMs %}
        <div class="stat-card">
          <div class="stat-value">{{ stats.durationMs | duration }}</div>
          <div class="stat-label">Duration</div>
        </div>
        {% endif %}
      </div>
    </header>

    <!-- Results Table -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            {% for varName in headers.vars %}
            <th class="var-col">{{ varName | escape }}</th>
            {% endfor %} {% for prompt in headers.prompts %}
            <th class="output-col">[{{ prompt.provider | escape }}] {{ prompt.label | escape }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in rows %}
          <tr id="row-{{ loop.index }}">
            {# Variable columns #} {% for varValue in row.vars %}
            <td class="var-cell">{{ varValue | escape }}</td>
            {% endfor %} {# Output columns #} {% for output in row.outputs %}
            <td>
              <div class="cell">
                {# Header: Badge + Score #}
                <div class="cell-header">
                  {% if output.failureReason == 'ERROR' %}
                  <span class="badge error">Error</span>
                  {% elif output.pass %}
                  <span class="badge pass">Pass</span>
                  {% else %}
                  <span class="badge fail">Fail</span>
                  {% endif %} {% if output.score is defined and output.score != 0 and output.score
                  != 1 %}
                  <span class="score">({{ output.score | round(2) }})</span>
                  {% endif %}
                </div>

                {# Named Scores #} {% if output.namedScores and output.namedScores | length > 0 %}
                <div class="named-scores">
                  {% for name, value in output.namedScores %}
                  <span class="metric-chip">
                    <span class="metric-name">{{ name | escape }}:</span>
                    <span class="metric-value">{{ value | round(2) }}</span>
                  </span>
                  {% endfor %}
                </div>
                {% endif %} {# Error/Fail Reason #} {% if output.error and output.failureReason ==
                'ERROR' %}
                <div class="error-reason">{{ output.error | escape }}</div>
                {% elif output.error and not output.pass %}
                <div class="fail-reason">{{ output.error | escape }}</div>
                {% elif output.gradingResult and output.gradingResult.reason and not output.pass %}
                <div class="fail-reason">{{ output.gradingResult.reason | escape }}</div>
                {% endif %} {# Content #} {% if output.isImage %}
                <img src="{{ output.text | escape }}" alt="Generated image" class="output-image" />
                <div class="media-print-placeholder">Image output</div>
                {% elif output.audio and output.audio.data %}
                <audio controls class="output-audio">
                  <source
                    src="data:audio/{{ output.audio.format | default('mp3') | escape }};base64,{{ output.audio.data }}"
                    type="audio/{{ output.audio.format | default('mp3') | escape }}"
                  />
                </audio>
                <div class="media-print-placeholder">
                  Audio output{% if output.audio.duration %} ({{ output.audio.duration }}s){% endif
                  %}
                </div>
                {% if output.audio.transcript %}
                <div class="transcript">
                  <strong>Transcript:</strong> {{ output.audio.transcript | escape }}
                </div>
                {% endif %} {% elif output.text and output.text | length > 500 %}
                <details class="content-wrapper">
                  <summary>{{ output.text | truncate(200) | escape }}</summary>
                  <div class="content-full">{{ output.text | escape }}</div>
                </details>
                {% elif output.text %}
                <div class="content-short">{{ output.text | escape }}</div>
                {% endif %} {# Assertions #} {% if output.gradingResult and
                output.gradingResult.componentResults and output.gradingResult.componentResults |
                length > 0 %}
                <details class="assertions-wrapper">
                  <summary>
                    {{ output.gradingResult.componentResults | length }} assertion{% if
                    output.gradingResult.componentResults | length != 1 %}s{% endif %}
                  </summary>
                  <ul class="assertion-list">
                    {% for result in output.gradingResult.componentResults %}
                    <li class="{{ 'pass' if result.pass else 'fail' }}">
                      {% if result.pass %}&#10003;{% else %}&#10007;{% endif %} {{ result.reason |
                      default((result.assertion.type if result.assertion else 'Unknown') |
                      default('Unknown')) | escape }}
                    </li>
                    {% endfor %}
                  </ul>
                </details>
                {% endif %} {# Metrics #} {% if output.tokenUsage or output.latencyMs or output.cost
                %}
                <div class="cell-metrics">
                  {% if output.tokenUsage and output.tokenUsage.total %}
                  <span>{{ output.tokenUsage.total | numberFormat }} tokens</span>
                  {% endif %} {% if output.latencyMs %}
                  <span>{{ output.latencyMs | round(0) }}ms</span>
                  {% endif %} {% if output.cost %}
                  <span>${{ output.cost | round(4) }}</span>
                  {% endif %}
                </div>
                {% endif %}
              </div>
            </td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Footer -->
    <footer class="page-footer">
      Generated by <a href="https://promptfoo.dev">Promptfoo</a> {% if shareableUrl %} &bull;
      <a href="{{ shareableUrl | escape }}">View interactive version</a>
      {% endif %}
    </footer>
  </body>
</html>
