# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: Vision-based grading using custom rubric prompts

prompts:
  - label: "Image Description Task"
    raw: |
      [
        {
          "role": "user",
          "content": [
            {
              "type": "text",
              "text": "Describe this image in detail:"
            },
            {
              "type": "image_url",
              "image_url": {
                "url": "data:image/png;base64,{{image}}"
              }
            }
          ]
        }
      ]

providers:
  - openai:gpt-4o-mini  # Vision-capable model for generating descriptions

# Configure the grading provider with vision capabilities
defaultTest:
  options:
    provider: openai:gpt-4o-mini  # Vision-capable model for grading

tests:
  - vars:
      image: file://test-images/shapes.png
    assert:
      # LLM-Rubric with custom vision prompt
      - type: llm-rubric
        value: |
          The description should accurately identify:
          1. All geometric shapes in the image
          2. Their colors
          3. Their spatial arrangement
        # Use custom rubric prompt that includes the image
        rubricPrompt: file://rubric-prompts/vision-llm-rubric.js
        threshold: 0.7
      
      # G-Eval with custom vision prompt
      - type: g-eval
        value: >-
          Visual accuracy - the description should correctly identify all visual elements
          including shapes, colors, positions, and any text or labels in the image
        # Use custom rubric prompt for vision
        rubricPrompt:
          steps: file://rubric-prompts/vision-g-eval.js:steps
          evaluate: file://rubric-prompts/vision-g-eval.js:evaluate
        threshold: 0.7
  
  - vars:
      image: file://test-images/chart.png
    assert:
      - type: llm-rubric
        value: |
          For a chart or graph, the description should:
          1. Identify the type of chart
          2. Describe the data being presented
          3. Note trends or patterns
          4. Mention specific values if visible
        rubricPrompt: file://rubric-prompts/vision-llm-rubric.js
        threshold: 0.75
