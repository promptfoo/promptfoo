# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: Multi-modal LLM-Rubric evaluation with provider-specific vision formatting

prompts:
  # OpenAI format for vision models
  - label: "Describe Image"
    raw: |
      [
        {
          "role": "user",
          "content": [
            {
              "type": "text",
              "text": "Describe this image in detail, including all shapes, colors, and text you can see."
            },
            {
              "type": "image_url",
              "image_url": {
                "url": "data:image/png;base64,{{image}}"
              }
            }
          ]
        }
      ]

providers:
  - openai:gpt-4o-mini
  - openai:gpt-4o
  - bedrock:anthropic.claude-3-sonnet-20240229-v1:0
  - bedrock:anthropic.claude-3-5-sonnet-20241022-v2:0
  - vertex:gemini-1.5-flash
  - vertex:gemini-1.5-pro
  - bedrock:amazon.nova-pro-v1:0

tests:
  # Test 1: Standard approach - images automatically included
  - description: "Geometric shapes - automatic image inclusion"
    vars:
      image: file://shapes.png
    assert:
      - type: llm-rubric
        value: |
          The output should accurately describe:
          1. Four geometric shapes: square, circle, triangle, and star
          2. Their colors: blue square, red circle, green triangle, yellow star
          3. The "Test Shapes" title at the top
          4. The 2x2 grid arrangement
        threshold: 0.8
        provider: openai:gpt-4o-mini  # Vision model - that's all you need!

  # Test 2: With custom YAML rubric
  - description: "Geometric shapes - custom YAML rubric"
    vars:
      image: file://shapes.png
    assert:
      - type: llm-rubric
        value: "Accurate shape and color identification"
        threshold: 0.8
        provider: openai:gpt-4o-mini
        rubricPrompt: file://rubrics/standard.yaml  # YAML format

  # Test 3: Multiple providers - all work automatically
  - description: "Shapes - Anthropic"
    vars:
      image: file://shapes.png
    assert:
      - type: llm-rubric
        value: "Identify all shapes and colors"
        threshold: 0.8
        provider: bedrock:anthropic.claude-3-sonnet-20240229-v1:0

  - description: "Shapes - Gemini"
    vars:
      image: file://shapes.png
    assert:
      - type: llm-rubric
        value: "Identify all shapes and colors"
        threshold: 0.8
        provider: vertex:gemini-1.5-flash

  - description: "Shapes - Nova"
    vars:
      image: file://shapes.png
    assert:
      - type: llm-rubric
        value: "Identify all shapes and colors"
        threshold: 0.8
        provider: bedrock:amazon.nova-pro-v1:0

  # Chart image test
  - description: "Bar chart analysis"
    vars:
      image: file://chart.png
    assert:
      - type: llm-rubric
        value: |
          The output should identify:
          1. Chart type: bar chart
          2. Title: "Sales Performance by Product"
          3. Four products labeled A, B, C, D
          4. Their relative values/heights
          5. Y-axis scale (0-50 in thousands)
        threshold: 0.7
        provider: openai:gpt-4o-mini
        rubricPrompt: file://rubrics/openai.js

      - type: llm-rubric
        value: |
          Check if the chart type, title, and product labels are correctly identified.
        threshold: 0.7
        provider: vertex:gemini-1.5-flash
        rubricPrompt: file://rubrics/gemini.js
