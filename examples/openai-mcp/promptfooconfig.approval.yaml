# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json

description: Testing OpenAI Responses API with MCP approval workflows

prompts:
  - 'Search for information about {{query}} in the {{repo}} repository'
  - 'What are the latest updates in {{repo}}?'

providers:
  # Provider with approval required (default behavior)
  - id: openai:responses:gpt-4.1
    label: 'With Approval Required'
    config:
      tools:
        - type: mcp
          server_label: deepwiki
          server_url: https://mcp.deepwiki.com/mcp
          # require_approval is not specified, so approval is required by default
      max_output_tokens: 1000
      temperature: 0.2
      instructions: 'You are a research assistant. When approval is required for MCP tools, explain what you would do if the tool were approved.'

  # Provider with selective approval
  - id: openai:responses:gpt-4.1
    label: 'Selective Approval'
    config:
      tools:
        - type: mcp
          server_label: deepwiki
          server_url: https://mcp.deepwiki.com/mcp
          require_approval:
            never:
              tool_names: ['read_wiki_structure']
          # ask_question will still require approval, but read_wiki_structure won't
      max_output_tokens: 1000
      temperature: 0.2
      instructions: 'You are a research assistant. Use the available tools to gather information.'

  # Provider with no approval required
  - id: openai:responses:gpt-4.1
    label: 'No Approval Required'
    config:
      tools:
        - type: mcp
          server_label: deepwiki
          server_url: https://mcp.deepwiki.com/mcp
          require_approval: never
      max_output_tokens: 1000
      temperature: 0.2
      instructions: 'You are a research assistant. Use the available MCP tools to search for information.'

tests:
  - vars:
      query: 'getting started guide'
      repo: 'facebook/react'
    assert:
      - type: contains
        value: 'react'
      - type: llm-rubric
        value: 'The response provides information about React or explains what would be searched'

  - vars:
      query: 'API documentation'
      repo: 'openai/openai-python'
    assert:
      - type: contains
        value: 'API'
      - type: llm-rubric
        value: 'The response mentions API documentation or explains the search intent'
