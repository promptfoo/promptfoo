# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json

description: OpenAI MCP tool integration

prompts:
  - 'What are the transport protocols supported in the MCP specification for {{repo}}?'
  - 'Can you search for information about {{topic}} in the {{repo}} repository and summarize the key points?'
  - 'What are the main features of {{repo}}? Please provide a detailed overview.'

providers:
  - id: openai:responses:gpt-4.1-2025-04-14
    config:
      tools:
        - type: mcp
          server_label: deepwiki
          server_url: https://mcp.deepwiki.com/mcp
          require_approval: never
          allowed_tools: ['ask_question', 'read_wiki_structure']
      max_output_tokens: 1500
      temperature: 0.3
      instructions: 'You are a helpful research assistant. Use the available MCP tools to search for accurate information about repositories and provide comprehensive answers.'

tests:
  - vars:
      repo: modelcontextprotocol/modelcontextprotocol
      topic: transport protocols
    assert:
      - type: contains
        value: 'transport'
      - type: contains
        value: 'protocol'
      - type: llm-rubric
        value: 'The response mentions specific transport protocols like HTTP or WebSocket'

  - vars:
      repo: facebook/react
      topic: hooks
    assert:
      - type: contains
        value: 'hook'
      - type: llm-rubric
        value: 'The response explains React hooks functionality'

  - vars:
      repo: microsoft/typescript
      topic: type system
    assert:
      - type: contains
        value: 'type'
      - type: llm-rubric
        value: "The response describes TypeScript's type system features"

  - vars:
      repo: openai/openai-python
      topic: API client
    assert:
      - type: contains
        value: 'API'
      - type: llm-rubric
        value: 'The response describes the OpenAI Python client library'
