# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: Intermediate Azure OpenAI Assistant with File Search and Weather Tool

# Environment variables needed
env:
  AZURE_API_KEY: $AZURE_API_KEY

prompts:
  - '{{prompt}}'

providers:
  - id: azure:assistant:asst_intermediate
    label: azure-assistant-intermediate
    config:
      apiHost: promptfoo.openai.azure.com
      # Define file search and a simple weather function
      tools:
        - type: "file_search"
          description: "Search through promptfoo documentation"
        - type: "function"
          function:
            name: "get_weather"
            description: "Get current weather information for a location"
            parameters:
              type: "object"
              properties:
                location:
                  type: "string"
                  description: "The city and state e.g. Seattle, WA"
                unit:
                  type: "string"
                  enum: ["c", "f"]
                  description: "Temperature unit (c for Celsius, f for Fahrenheit)"
              required: ["location"]
      # Simple inline function callback for weather
      functionToolCallbacks:
        get_weather: |
          async function(args) {
            try {
              const parsedArgs = JSON.parse(args);
              const location = parsedArgs.location;
              const unit = parsedArgs.unit || 'c';
              console.log(`Weather request for ${location} in ${unit}`);
              
              // Simple weather response
              return JSON.stringify({
                location,
                temperature: unit === 'c' ? 22 : 72,
                unit,
                condition: 'sunny',
                forecast: 'Clear skies for the next few days.'
              });
            } catch (error) {
              console.error('Error in get_weather function:', error);
              return JSON.stringify({ error: String(error) });
            }
          }
      # Vector store configuration
      tool_resources:
        file_search:
          vector_store_ids:
            - "vs_promptfoo_docs_main"
      # Standard parameters
      temperature: 0.7
      apiVersion: "2024-05-01-preview"
      debug: true

tests:
  # File search tests
  - vars:
      prompt: What is promptfoo and how does it help with evaluating LLMs?
  - vars:
      prompt: Can you search the documentation for information about vector stores?
  
  # Weather function tests
  - vars:
      prompt: What's the weather like in Seattle?
  - vars:
      prompt: Tell me about the weather in Tokyo in Celsius.
  
  # Tool selection test - should use file search
  - vars:
      prompt: How do I configure promptfoo for evaluating different models?
  
  # Tool selection test - should use weather function
  - vars:
      prompt: I'm planning a trip to London. What's the weather forecast? 