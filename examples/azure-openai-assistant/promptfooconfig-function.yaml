# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: Azure OpenAI Assistant with Function Tool Capability

prompts:
  - '{{prompt}}'

providers:
  - id: azure:assistant:asst_example
    label: azure-assistant-function
    config:
      apiHost: promptfoo.openai.azure.com
      # Load tools from external file
      tools: file://tools/weather-function.json
      # Inline function callback definition
      functionToolCallbacks:
        get_weather: |
          async function(args) {
            try {
              const parsedArgs = JSON.parse(args);
              const location = parsedArgs.location;
              const unit = parsedArgs.unit || 'celsius';
              console.log(`Weather request for ${location} in ${unit}`);
              
              // Simple weather response
              const temp = unit === 'celsius' ? 22 : 72;
              return JSON.stringify({
                location,
                temperature: temp,
                unit,
                condition: 'sunny',
                forecast: 'Clear skies for the next few days.'
              });
            } catch (error) {
              console.error('Error in weather function:', error);
              return JSON.stringify({ error: String(error) });
            }
          }
      temperature: 0.7
      apiVersion: '2024-05-01-preview'
      debug: true

tests:
  # Function tool invocation tests
  - vars:
      prompt: What's the weather like in Seattle?
  - vars:
      prompt: Tell me about the weather in Tokyo in Celsius.
  - vars:
      prompt: Compare the weather in New York and London.
  - vars:
      prompt: What's the weather forecast for San Francisco in Fahrenheit? 