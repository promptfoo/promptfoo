# Example: RAGAS-compatible noise sensitivity testing
# This demonstrates how to use labeled context chunks for accurate noise sensitivity measurement

description: 'Noise sensitivity evaluation with labeled context chunks'

providers:
  - openai:gpt-4o-mini

prompts:
  - |
    Based on the following context, answer the question.
    
    Context:
    {{#each contextChunks}}
    {{this.text}}
    {{/each}}
    
    Question: {{query}}
    
    Answer:

tests:
  # Test 1: Relevant mode - all incorrect claims count
  - description: 'Test with relevant context containing some noise'
    vars:
      query: 'What is the capital of France and what is it known for?'
      contextChunks:
        - text: 'Paris is the capital of France, known for the Eiffel Tower.'
          relevant: true
        - text: 'The city has excellent cuisine and many museums.'
          relevant: true  
        - text: 'Berlin is the capital of Germany with a vibrant tech scene.'
          relevant: true  # Even though it's about Germany, marked as relevant for this mode
    assert:
      - type: noise-sensitivity
        value: 'Paris is the capital of France. It is known for the Eiffel Tower, excellent cuisine, and many museums.'
        threshold: 0.3
        config:
          mode: relevant
          contextChunks: '{{contextChunks}}'

  # Test 2: Irrelevant mode - only claims from irrelevant chunks count
  - description: 'Test ability to ignore irrelevant context'
    vars:
      query: 'What programming language is known for machine learning?'
      contextChunks:
        - text: 'Python is widely used for machine learning and data science.'
          relevant: true
        - text: 'It has libraries like TensorFlow, PyTorch, and scikit-learn.'
          relevant: true
        - text: 'JavaScript is primarily used for web development.'
          relevant: false  # Irrelevant to the query
        - text: 'Ruby is known for its elegant syntax and Rails framework.'
          relevant: false  # Irrelevant to the query
    assert:
      - type: noise-sensitivity
        value: 'Python is widely used for machine learning and data science. It has libraries like TensorFlow, PyTorch, and scikit-learn.'
        threshold: 0.2
        config:
          mode: irrelevant
          contextChunks: '{{contextChunks}}'

  # Test 3: Mixed context with high noise
  - description: 'Test with mostly irrelevant context'
    vars:
      query: 'What is the speed of light?'
      contextChunks:
        - text: 'The speed of light in vacuum is approximately 299,792,458 meters per second.'
          relevant: true
        - text: 'Water boils at 100 degrees Celsius at sea level.'
          relevant: false
        - text: 'The Earth orbits the Sun once every 365.25 days.'
          relevant: false
        - text: 'Gold has an atomic number of 79.'
          relevant: false
        - text: 'The Pacific Ocean is the largest ocean on Earth.'
          relevant: false
    assert:
      - type: noise-sensitivity
        value: 'The speed of light in vacuum is approximately 299,792,458 meters per second.'
        threshold: 0.1  # Strict threshold - model should focus only on relevant info
        config:
          mode: irrelevant
          contextChunks: '{{contextChunks}}'