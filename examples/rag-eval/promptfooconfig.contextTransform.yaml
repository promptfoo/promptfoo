# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: RAG evaluation using contextTransform to extract context from responses

prompts:
  - |
    You are an internal corporate chatbot.
    Respond to this query: {{query}}
    Here is some context that you can use to write your response: {{context}}

providers:
  - file://rag-provider-with-context.js

tests:
  - vars:
      query: What is the max purchase that doesn't require approval?
    assert:
      # Basic assertions that should pass
      - type: contains
        value: '$500'
      - type: contains
        value: 'approval'
      # Demonstrate contextTransform functionality
      - type: context-relevance
        contextTransform: 'output.split("CONTEXT:")[1]?.split("ANSWER:")[0]?.trim() || ""'
        threshold: 0.3
      - type: context-faithfulness
        contextTransform: 'output.split("CONTEXT:")[1]?.split("ANSWER:")[0]?.trim() || ""'
        threshold: 0.3
        
  - vars:
      query: How many weeks is maternity leave?
    assert:
      # Basic assertions that should pass
      - type: contains
        value: '4 months'
      - type: contains
        value: 'maternity'
      # Demonstrate contextTransform functionality  
      - type: context-relevance
        contextTransform: 'output.split("CONTEXT:")[1]?.split("ANSWER:")[0]?.trim() || ""'
        threshold: 0.3
      - type: context-faithfulness
        contextTransform: 'output.split("CONTEXT:")[1]?.split("ANSWER:")[0]?.trim() || ""'
        threshold: 0.3 