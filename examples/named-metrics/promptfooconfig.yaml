# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: Custom metric naming and derivation for evaluation

prompts:
  - 'Say this as though you are a pirate: {{body}}'
  - 'Say this as though you are a seafarer from the 17th century: {{body}}'

providers:
  - echo # Using echo provider for easy demonstration without API keys

derivedMetrics:
  - name: DoubleConsistency
    value: Consistency * 2

# Demonstrates dynamic metric naming via defaultTest.assert
# The metric field supports Nunjucks template variables from test.vars
defaultTest:
  assert:
    - type: icontains
      value: '{{keyword}}'
      metric: '{{metricCategory}}'

tests:
  # These tests use the dynamic metric from defaultTest
  - description: Check for pirate tone (dynamic metric)
    vars:
      body: Yarr, matey!
      keyword: yarr
      metricCategory: PirateTone

  - description: Check for hunger-related words (dynamic metric)
    vars:
      body: I need some grub
      keyword: grub
      metricCategory: PirateTone

  # This test combines dynamic metric with static metric
  - description: Check for message keyword with static metric
    vars:
      body: The message was delivered
      keyword: message
      metricCategory: FormatCheck
    assert:
      - type: contains
        value: delivered
        metric: Consistency

  # Multiple assertions with different metric types
  - description: Check for greeting with multiple metrics
    vars:
      body: Ahoy, world
      keyword: ahoy
      metricCategory: Greeting
    assert:
      - type: javascript
        value: output.startsWith('Say this')
        metric: FormatValidation

  # Demonstrates combining dynamic and static metrics
  - description: Complex validation with mixed metrics
    vars:
      body: The pirate spoke clearly
      keyword: pirate
      metricCategory: ContentCheck
    assert:
      - type: contains
        value: pirate
        metric: Tone
