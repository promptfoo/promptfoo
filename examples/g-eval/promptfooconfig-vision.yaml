# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: G-Eval with vision-based grading using provider-specific rubric prompts

prompts:
  # OpenAI format
  - label: "OpenAI Vision"
    raw: |
      [
        {
          "role": "user",
          "content": [
            {
              "type": "text",
              "text": "Describe this image in detail, including all shapes, colors, and text:"
            },
            {
              "type": "image_url",
              "image_url": {
                "url": "data:image/png;base64,{{image}}"
              }
            }
          ]
        }
      ]

  # Anthropic format
  - label: "Anthropic Vision"
    raw: |
      [
        {
          "role": "user",
          "content": [
            {
              "type": "text",
              "text": "Describe this image in detail, including all shapes, colors, and text:"
            },
            {
              "type": "image",
              "source": {
                "type": "base64",
                "media_type": "image/png",
                "data": "{{image}}"
              }
            }
          ]
        }
      ]

  # Gemini format
  - label: "Gemini Vision"
    raw: |
      [
        {
          "role": "user",
          "parts": [
            {
              "text": "Describe this image in detail, including all shapes, colors, and text:"
            },
            {
              "inline_data": {
                "mime_type": "image/png",
                "data": "{{image}}"
              }
            }
          ]
        }
      ]

  # Nova format
  - label: "Nova Vision"
    raw: |
      [
        {
          "role": "user",
          "content": [
            {
              "text": "Describe this image in detail, including all shapes, colors, and text:"
            },
            {
              "image": {
                "format": "png",
                "source": {
                  "bytes": "{{image}}"
                }
              }
            }
          ]
        }
      ]

providers:
  - id: openai-vision
    config:
      apiProvider: openai:gpt-4o-mini
      
  - id: anthropic-vision
    config:
      apiProvider: bedrock:anthropic.claude-3-sonnet-20240229-v1:0
      
  - id: gemini-vision
    config:
      apiProvider: vertex:gemini-1.5-flash
      
  - id: nova-vision
    config:
      apiProvider: bedrock:amazon.nova-pro-v1:0

tests:
  # Test with shapes image
  - description: "Geometric shapes test"
    vars:
      image: file://test-image.png
    assert:
      # OpenAI grading
      - type: g-eval
        value: >-
          Visual Accuracy - The description should correctly identify four geometric shapes
          (square, circle, triangle, star), their colors (blue, red, green, yellow),
          the "Test Shapes" title, and their 2x2 grid arrangement.
        threshold: 0.7
        provider: openai:gpt-4o-mini
        rubricPrompt: file://vision-rubrics/openai.js

      # Anthropic grading
      - type: g-eval
        value: >-
          Visual Accuracy - The description should correctly identify four geometric shapes
          (square, circle, triangle, star), their colors (blue, red, green, yellow),
          the "Test Shapes" title, and their 2x2 grid arrangement.
        threshold: 0.7
        provider: bedrock:anthropic.claude-3-sonnet-20240229-v1:0
        rubricPrompt: file://vision-rubrics/anthropic.js

      # Gemini grading
      - type: g-eval
        value: >-
          Visual Accuracy - The description should correctly identify four geometric shapes
          (square, circle, triangle, star), their colors (blue, red, green, yellow),
          the "Test Shapes" title, and their 2x2 grid arrangement.
        threshold: 0.7
        provider: vertex:gemini-1.5-flash
        rubricPrompt: file://vision-rubrics/gemini.js

  # Test with chart image
  - description: "Bar chart test"
    vars:
      image: file://test-chart.png
    assert:
      - type: g-eval
        value: >-
          Chart Analysis - The description should identify the chart type (bar chart),
          title ("Sales Performance by Product"), four products (A, B, C, D),
          their approximate values, and any visible trends.
        threshold: 0.7
        provider: openai:gpt-4o-mini
        rubricPrompt: file://vision-rubrics/openai.js
