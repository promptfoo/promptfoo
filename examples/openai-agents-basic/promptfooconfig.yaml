# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: Interactive text adventure with AI Dungeon Master

prompts:
  - '{{query}}'

providers:
  - id: openai:agents:dungeon-master
    config:
      agent: file://./agents/weather-agent.ts
      tools: file://./tools/weather-tools.ts
      maxTurns: 10
      tracing: true

tests:
  - description: Dragon combat encounter
    vars:
      query: 'I draw my sword and charge at the dragon!'
    assert:
      - type: llm-rubric
        value: Response includes dice roll for attack and describes combat outcome
      - type: javascript
        value: |
          // Should use roll_dice tool
          return output.toLowerCase().includes('roll') ||
                 output.toLowerCase().includes('d20') ||
                 output.toLowerCase().includes('dice');

  - description: Search for hidden treasure
    vars:
      query: 'I search the dusty chest in the corner'
    assert:
      - type: llm-rubric
        value: Response describes what is found with creative detail

  - description: Check inventory mid-adventure
    vars:
      query: 'What items do I have?'
    assert:
      - type: contains
        value: Rusty Sword
      - type: contains
        value: Health Potion
      - type: javascript
        value: |
          // Should use check_inventory tool
          return output.includes('gold');

  - description: Enter mysterious dungeon
    vars:
      query: 'I cautiously enter the dark dungeon'
    assert:
      - type: llm-rubric
        value: Response paints atmospheric scene and presents choices
      - type: javascript
        value: |
          // Should use describe_scene tool
          return output.length > 80;

  - description: Attempt ridiculous action
    vars:
      query: 'I try to befriend the treasure chest by singing to it'
    assert:
      - type: llm-rubric
        value: DM responds with humor while keeping adventure engaging
