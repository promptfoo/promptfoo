# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: Cost Calculation Test

prompts:
  - 'Generate an image of {{subject}}'

providers:
  - id: google:gemini-2.5-flash-image-preview
    config:
      generationConfig:
        temperature: 0.7
        maxOutputTokens: 1024
        responseModalities:
          - IMAGE
          - TEXT

tests:
  - description: 'Simple cost test'
    vars:
      subject: 'a simple red circle'
    assert:
      - type: contains
        value: '![Generated Image]'
      - type: cost
        threshold: 0.05 # Should be ~$0.039 per image
      - type: javascript
        value: |
          // Check that we have token usage and cost information
          const hasTokens = context.vars.tokenUsage && context.vars.tokenUsage.total > 1000;
          const hasCost = context.vars.cost && context.vars.cost > 0.03 && context.vars.cost < 0.05;

          return { 
            pass: hasTokens && hasCost, 
            score: hasTokens && hasCost ? 1 : 0,
            reason: `Tokens: ${context.vars.tokenUsage?.total}, Cost: $${context.vars.cost?.toFixed(4)}`
          };
