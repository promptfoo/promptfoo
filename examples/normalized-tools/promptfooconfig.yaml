# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: 'Normalized tools example - cross-provider tool calling'

providers:
  - id: openai:gpt-4o-mini
    label: 'OpenAI GPT-4o-mini'
    config:
      tools: &tools
        - normalized: true
          name: get_weather
          description: Get the current weather for a location
          parameters:
            type: object
            properties:
              location:
                type: string
                description: The city and state, e.g. San Francisco, CA
              unit:
                type: string
                enum: [celsius, fahrenheit]
                description: The temperature unit
            required:
              - location
      tool_choice: &tool_choice
        mode: required

  - id: anthropic:claude-3-5-haiku-latest
    label: 'Anthropic Claude Haiku'
    config:
      tools: *tools
      tool_choice: *tool_choice

  # HTTP provider using OpenAI API directly with transformToolsFormat
  - id: https://api.openai.com/v1/chat/completions
    label: 'HTTP Provider (OpenAI API)'
    config:
      method: POST
      headers:
        Content-Type: application/json
        Authorization: 'Bearer {{env.OPENAI_API_KEY}}'
      transformToolsFormat: openai
      tools: *tools
      tool_choice: *tool_choice
      body:
        model: gpt-4o-mini
        messages:
          - role: user
            content: '{{prompt}}'
        tools: '{{tools | dump}}'
        tool_choice: '{{tool_choice | dump}}'
      responseParser: 'json.choices[0].message.tool_calls'

prompts:
  - 'What is the weather like in {{location}}?'

tests:
  - vars:
      location: San Francisco
    assert:
      - type: tool-call-f1
        value: ['get_weather']

  - vars:
      location: Tokyo, Japan
    assert:
      - type: tool-call-f1
        value: ['get_weather']

  - vars:
      location: London, UK
    assert:
      - type: tool-call-f1
        value: ['get_weather']
