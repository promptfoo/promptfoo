description: ElevenLabs Speech-to-Text (STT) - Transcription accuracy testing

# STT uses audio files as inputs instead of text prompts
# Each prompt should be the path to an audio file
prompts:
  - audio/sample1.mp3
  - audio/sample2.wav
  - audio/sample3_multiple_speakers.mp3

providers:
  # Basic transcription
  - id: elevenlabs:stt:basic
    label: Basic Transcription
    config:
      modelId: eleven_speech_to_text_v1
      language: en

  # Transcription with speaker diarization
  - id: elevenlabs:stt:diarization
    label: With Speaker Diarization
    config:
      modelId: eleven_speech_to_text_v1
      language: en
      diarization: true
      maxSpeakers: 3

  # Accuracy testing with WER calculation
  - id: elevenlabs:stt:accuracy
    label: Accuracy Testing (WER)
    config:
      modelId: eleven_speech_to_text_v1
      language: en
      calculateWER: true
      referenceText: The quick brown fox jumps over the lazy dog

tests:
  - description: Transcription quality
    assert:
      - type: cost
        threshold: 0.05
      - type: latency
        threshold: 10000

  - description: Diarization accuracy
    vars:
      audioFile: audio/sample3_multiple_speakers.mp3
    assert:
      - type: javascript
        value: output.includes('Speaker')

  - description: WER accuracy threshold
    vars:
      audioFile: audio/sample1.mp3
      referenceText: The quick brown fox jumps over the lazy dog
    assert:
      - type: javascript
        value: |
          // Word Error Rate should be less than 10% for clear audio
          const wer = context.vars.metadata?.wer?.wer || 1;
          wer < 0.1

# Default test configuration
defaultTest:
  # All tests will require transcription to complete
  assert:
    - type: not-contains
      value: error
