prompts:
  - 'What is the weather like in {{city}}?'

providers:
  - id: openai:chat:gpt-4o-2024-08-06
    config:
      response_format:
        type: json_schema
        json_schema:
          name: weather_response
          strict: true
          schema:
            type: object
            properties:
              temperature:
                type: number
              description:
                type: string
              unit:
                type: string
                enum: [celsius, fahrenheit]
            required: [temperature, description, unit]
            additionalProperties: false

tests:
  - vars:
      city: Boston
    assert:
      - type: is-json
        value:
          required:
            - 'temperature'
            - 'description'
            - 'unit'
          type: object
          properties:
            temperature:
              type: number
            description:
              type: string
            unit:
              type: string
              enum: [celsius, fahrenheit]
      - type: javascript
        value: typeof output.temperature === 'number' && typeof output.description === 'string' && ['celsius', 'fahrenheit'].includes(output.unit)

  - vars:
      city: New York
    assert:
      - type: is-json
      - type: javascript
        value: Object.keys(output).length === 3

  - vars:
      city: Paris
    assert:
      - type: is-json
      - type: javascript
        value: output.unit === 'celsius'
