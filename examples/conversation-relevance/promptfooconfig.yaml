# Example of using the conversation-relevance assertion
# This metric evaluates whether responses remain relevant throughout a conversation

description: 'Conversation Relevance Example'

providers:
  - id: openai:gpt-4o-mini
    config:
      temperature: 0

prompts:
  - "You are a helpful assistant. Answer the user's questions accurately and stay on topic."

tests:
  # Example 1: Single turn conversation - tests basic relevance
  - description: 'Single turn - relevant response'
    vars:
      prompt: 'What is the capital of France?'
      output: 'The capital of France is Paris.'
    assert:
      - type: conversation-relevance
        threshold: 0.8

  # Example 2: Multi-turn conversation with good relevance
  - description: 'Multi-turn - all responses relevant'
    vars:
      _conversation:
        - input: 'What is the capital of France?'
          output: 'The capital of France is Paris.'
        - input: 'What is its population?'
          output: 'Paris has a population of approximately 2.1 million people in the city proper.'
        - input: 'What are some famous landmarks there?'
          output: 'Famous landmarks in Paris include the Eiffel Tower, Louvre Museum, Notre-Dame Cathedral, and Arc de Triomphe.'
      prompt: 'Tell me more about the Louvre.'
      output: "The Louvre is the world's largest art museum, housing over 35,000 works including the Mona Lisa and Venus de Milo."
    assert:
      - type: conversation-relevance
        threshold: 0.8

  # Example 3: Off-topic response - should fail
  - description: 'Off-topic response - should fail'
    vars:
      _conversation:
        - input: 'What is the capital of France?'
          output: 'The capital of France is Paris.'
      prompt: 'What is 3 + 3?'
      output: 'The capital of France is Paris.'
    assert:
      - type: conversation-relevance
        threshold: 0.8

  # Example 4: Vague greeting - should pass
  - description: 'Vague greeting - should pass'
    vars:
      prompt: 'Hello'
      output: 'Hello! How can I help you today?'
    assert:
      - type: conversation-relevance
        threshold: 0.8

  # Example 5: Context-dependent conversation
  - description: 'Context-dependent conversation'
    vars:
      _conversation:
        - input: "I'm looking for a good Italian restaurant"
          output: "I'd be happy to help you find a good Italian restaurant! What city are you in?"
        - input: "I'm in New York"
          output: "Great! New York has many excellent Italian restaurants. What's your budget range?"
      prompt: 'Something mid-range would be perfect'
      output: "For mid-range Italian in NYC, I recommend Carbone in Greenwich Village or L'Artusi in the West Village. Both offer authentic Italian cuisine with great atmosphere."
    assert:
      - type: conversation-relevance
        threshold: 0.8
        windowSize: 3
