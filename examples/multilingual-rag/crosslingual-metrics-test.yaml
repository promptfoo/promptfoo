# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: Testing context metrics with cross-lingual document/query pairs

prompts:
  - |
    You are a multilingual assistant. Answer the question based on the provided context.
    
    Question: {{query}}
    
    Context:
    {{context}}
    
    Important: Answer in the same language as the question, using information from the context even if it's in a different language.

providers:
  - openai:gpt-4o-mini
  - openai:gpt-4o
  - anthropic:messages:claude-3-5-haiku-20241022

defaultTest:
  assert:
    # Testing all context-based metrics
    - type: context-faithfulness
      threshold: 0.0  # Set to 0 to see actual scores
    - type: context-relevance
      threshold: 0.0  # Set to 0 to see actual scores
    - type: context-recall
      value: "{{expected_answer}}"
      threshold: 0.0  # Set to 0 to see actual scores

tests:
  # SCENARIO 1: English documents, questions in other languages
  
  - description: "EN doc -> ES question: Climate change"
    vars:
      query: "¿Cuáles son las principales causas del cambio climático?"
      context: |
        Climate change is primarily caused by greenhouse gas emissions from human activities. 
        The burning of fossil fuels such as coal, oil, and natural gas releases carbon dioxide into the atmosphere. 
        Deforestation reduces the Earth's capacity to absorb CO2. 
        Industrial agriculture and livestock farming produce methane, another potent greenhouse gas. 
        Transportation, especially cars and airplanes, contributes significantly to emissions.
      expected_answer: "Las causas principales del cambio climático son las emisiones de gases de efecto invernadero, la quema de combustibles fósiles, la deforestación, la agricultura y el transporte"
    assert:
      - type: answer-relevance
        threshold: 0.0

  - description: "EN doc -> FR question: Renewable energy"
    vars:
      query: "Quels sont les avantages de l'énergie renouvelable?"
      context: |
        Renewable energy offers numerous benefits for society and the environment.
        It produces little to no greenhouse gas emissions, helping combat climate change.
        Renewable sources like solar and wind are inexhaustible on a human timescale.
        These energy sources reduce dependence on imported fossil fuels, enhancing energy security.
        The renewable energy sector creates jobs and stimulates economic growth.
        Operating costs are low once infrastructure is installed.
      expected_answer: "Les avantages incluent: réduction des émissions, ressources inépuisables, sécurité énergétique, création d'emplois, croissance économique, faibles coûts d'exploitation"

  - description: "EN doc -> ZH question: Artificial Intelligence"
    vars:
      query: "人工智能的主要应用领域是什么？"
      context: |
        Artificial Intelligence has transformative applications across many industries.
        In healthcare, AI assists with disease diagnosis, drug discovery, and personalized treatment plans.
        Financial services use AI for fraud detection, risk assessment, and algorithmic trading.
        Transportation benefits from AI through autonomous vehicles and traffic optimization.
        Education uses AI for personalized learning and intelligent tutoring systems.
        Manufacturing employs AI for predictive maintenance and quality control.
      expected_answer: "人工智能的主要应用领域包括医疗保健、金融服务、交通运输、教育和制造业"

  - description: "EN doc -> JA question: Neural networks"
    vars:
      query: "ニューラルネットワークはどのように動作しますか？"
      context: |
        Neural networks are computational models inspired by the human brain.
        They consist of layers of interconnected nodes called neurons.
        Each connection has a weight that gets adjusted during training.
        Data flows through the network in a forward pass to produce outputs.
        The network learns by comparing outputs to expected results and calculating errors.
        Backpropagation adjusts weights to minimize these errors.
        This process repeats thousands of times until the network learns patterns.
      expected_answer: "ニューラルネットワークは相互接続されたニューロンの層で構成され、重みを調整しながら学習し、バックプロパゲーションでエラーを最小化します"

  - description: "EN doc -> AR question: Solar energy"
    vars:
      query: "ما هي فوائد الطاقة الشمسية؟"
      context: |
        Solar energy provides clean, renewable power from the sun.
        Solar panels produce electricity without greenhouse gas emissions.
        Once installed, solar systems have very low operating costs.
        Solar energy reduces electricity bills and can generate income through net metering.
        It provides energy independence and security.
        Solar installations can last 25-30 years with minimal maintenance.
        The technology creates jobs in manufacturing, installation, and maintenance.
      expected_answer: "فوائد الطاقة الشمسية: طاقة نظيفة، لا انبعاثات، تكاليف تشغيل منخفضة، تقليل فواتير الكهرباء، استقلال الطاقة، 25-30 سنة عمر"

  # SCENARIO 2: Foreign language documents, English questions
  
  - description: "ES doc -> EN question: Climate change"
    vars:
      query: "What are the main causes of climate change?"
      context: |
        El cambio climático es causado principalmente por las emisiones de gases de efecto invernadero.
        La quema de combustibles fósiles como el carbón, el petróleo y el gas natural libera dióxido de carbono.
        La deforestación reduce la capacidad de la Tierra para absorber CO2.
        La agricultura industrial y la ganadería producen metano.
        El transporte, especialmente los automóviles y aviones, contribuye significativamente.
        Las actividades industriales también liberan grandes cantidades de gases contaminantes.
      expected_answer: "Main causes include greenhouse gas emissions, burning fossil fuels, deforestation, industrial agriculture producing methane, and transportation"

  - description: "FR doc -> EN question: Renewable energy"
    vars:
      query: "What are the benefits of renewable energy?"
      context: |
        L'énergie renouvelable offre de nombreux avantages pour la société.
        Elle produit peu ou pas d'émissions de gaz à effet de serre.
        Les sources renouvelables comme le solaire et l'éolien sont inépuisables.
        Ces sources d'énergie réduisent la dépendance aux combustibles fossiles importés.
        Le secteur des énergies renouvelables crée des emplois.
        Les coûts d'exploitation sont faibles une fois l'infrastructure installée.
        L'énergie renouvelable améliore la sécurité énergétique nationale.
      expected_answer: "Benefits include low emissions, inexhaustible resources, reduced fossil fuel dependence, job creation, low operating costs, and energy security"

  - description: "ZH doc -> EN question: AI applications"
    vars:
      query: "What are the main applications of artificial intelligence?"
      context: |
        人工智能在许多行业都有重要应用。
        在医疗保健领域，AI协助疾病诊断、药物发现和个性化治疗。
        金融服务使用AI进行欺诈检测、风险评估和算法交易。
        交通运输通过自动驾驶汽车和交通优化受益于AI。
        教育使用AI实现个性化学习和智能辅导系统。
        制造业采用AI进行预测性维护和质量控制。
        客户服务利用AI聊天机器人提供24/7支持。
      expected_answer: "AI applications include healthcare diagnostics, financial fraud detection, autonomous vehicles, personalized education, predictive maintenance, and customer service chatbots"

  - description: "JA doc -> EN question: Neural networks"
    vars:
      query: "How do neural networks work?"
      context: |
        ニューラルネットワークは人間の脳に着想を得た計算モデルです。
        ニューロンと呼ばれる相互接続されたノードの層で構成されています。
        各接続には、トレーニング中に調整される重みがあります。
        データは順伝播でネットワークを通過し、出力を生成します。
        ネットワークは出力と期待される結果を比較してエラーを計算します。
        バックプロパゲーションが重みを調整してエラーを最小化します。
        このプロセスは、ネットワークがパターンを学習するまで何千回も繰り返されます。
      expected_answer: "Neural networks consist of interconnected neurons with adjustable weights, learn through forward propagation and backpropagation to minimize errors"

  - description: "AR doc -> EN question: Solar energy"
    vars:
      query: "What are the benefits of solar energy?"
      context: |
        الطاقة الشمسية توفر طاقة نظيفة ومتجددة من الشمس.
        الألواح الشمسية تنتج الكهرباء دون انبعاثات غازات الدفيئة.
        بمجرد التثبيت، أنظمة الطاقة الشمسية لديها تكاليف تشغيل منخفضة جداً.
        الطاقة الشمسية تقلل فواتير الكهرباء ويمكن أن تولد دخلاً.
        توفر استقلالية وأمن الطاقة.
        التركيبات الشمسية يمكن أن تستمر 25-30 سنة مع الحد الأدنى من الصيانة.
        التكنولوجيا تخلق وظائف في التصنيع والتركيب والصيانة.
      expected_answer: "Solar energy benefits: clean power, no emissions, low operating costs, reduced bills, energy independence, 25-30 year lifespan, job creation"

  # SCENARIO 3: Complex cross-lingual with technical content
  
  - description: "DE doc -> EN question: Quantum computing"
    vars:
      query: "What are the applications of quantum computing?"
      context: |
        Quantencomputer haben revolutionäre Anwendungen in verschiedenen Bereichen.
        In der Kryptographie können sie bestehende Verschlüsselungen brechen.
        Die Medikamentenentwicklung profitiert von Quantensimulationen molekularer Interaktionen.
        Finanzmodellierung wird durch Quantenalgorithmen verbessert.
        Materialwissenschaft nutzt Quantencomputer für neue Materialien.
        Optimierungsprobleme in Logistik können effizienter gelöst werden.
        Künstliche Intelligenz wird durch Quantenalgorithmen beschleunigt.
      expected_answer: "Quantum computing applications: cryptography, drug development, financial modeling, materials science, logistics optimization, AI acceleration"

  - description: "PT doc -> EN question: Digital transformation"
    vars:
      query: "What are the challenges of digital transformation?"
      context: |
        A transformação digital apresenta vários desafios importantes.
        A modernização de sistemas legados é cara e complexa.
        A resistência dos funcionários à mudança é comum.
        Riscos de segurança cibernética aumentam com a digitalização.
        O investimento inicial é alto com retorno incerto.
        Falta de profissionais qualificados no mercado.
        Integração entre diferentes departamentos é difícil.
        Conformidade regulatória adiciona complexidade.
      expected_answer: "Challenges include legacy system modernization, employee resistance, cybersecurity risks, high investment, skills shortage, integration difficulties, regulatory compliance"

  # SCENARIO 4: Testing metric edge cases
  
  - description: "Mixed EN/ES doc -> EN question: Should handle mixed languages"
    vars:
      query: "What is machine learning?"
      context: |
        Machine learning es una rama de artificial intelligence.
        It enables computers to learn from datos without explicit programming.
        Los algoritmos de ML include supervised, unsupervised, and reinforcement learning.
        Applications range from reconocimiento de imágenes to procesamiento de lenguaje natural.
      expected_answer: "Machine learning is AI that enables computers to learn from data, using supervised, unsupervised, and reinforcement learning algorithms"

  - description: "Technical EN doc -> DE question: Programming concepts"
    vars:
      query: "Was ist eine REST API?"
      context: |
        REST (Representational State Transfer) is an architectural style for web services.
        It uses HTTP methods like GET, POST, PUT, and DELETE.
        REST APIs are stateless, meaning each request contains all necessary information.
        Resources are identified by URIs and manipulated using standard operations.
        JSON is commonly used for data exchange in REST APIs.
      expected_answer: "REST API ist ein Architekturstil für Webdienste, der HTTP-Methoden verwendet, zustandslos ist und JSON für Datenaustausch nutzt"
