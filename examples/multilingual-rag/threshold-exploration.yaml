# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: Exploring optimal thresholds for cross-lingual RAG metrics

prompts:
  - |
    You are a multilingual assistant. Answer the question based on the provided context.
    
    Question: {{query}}
    
    Context:
    {{context}}
    
    Instructions:
    - Answer in the same language as the question
    - Use ONLY information from the provided context
    - If context is insufficient, say so clearly

providers:
  - openai:gpt-4o-mini
  - anthropic:messages:claude-3-5-haiku-20241022

tests:
  # GROUP 1: Same language (baseline for comparison)
  - description: "BASELINE: EN-EN (same language)"
    vars:
      query: "What causes climate change?"
      context: |
        Climate change is caused by greenhouse gas emissions, primarily from burning fossil fuels.
        Deforestation reduces CO2 absorption. Agriculture produces methane.
        Transportation and industry contribute significantly to emissions.
      expected_answer: "Climate change is caused by greenhouse gas emissions from fossil fuels, deforestation, agriculture, and transportation"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0
      - type: answer-relevance
        threshold: 0

  - description: "BASELINE: ES-ES (same language)"
    vars:
      query: "¿Qué causa el cambio climático?"
      context: |
        El cambio climático es causado por emisiones de gases de efecto invernadero, principalmente por la quema de combustibles fósiles.
        La deforestación reduce la absorción de CO2. La agricultura produce metano.
        El transporte y la industria contribuyen significativamente a las emisiones.
      expected_answer: "El cambio climático es causado por emisiones de gases de efecto invernadero de combustibles fósiles, deforestación, agricultura y transporte"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0
      - type: answer-relevance
        threshold: 0

  # GROUP 2: Related languages (Romance languages)
  - description: "RELATED: ES doc -> PT question"
    vars:
      query: "O que causa as mudanças climáticas?"
      context: |
        El cambio climático es causado por emisiones de gases de efecto invernadero.
        La quema de combustibles fósiles libera CO2. La deforestación es un factor importante.
        La agricultura y el transporte también contribuyen.
      expected_answer: "As mudanças climáticas são causadas por emissões de gases de efeito estufa, combustíveis fósseis, desmatamento"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0

  - description: "RELATED: FR doc -> ES question"
    vars:
      query: "¿Cuáles son los beneficios de la energía solar?"
      context: |
        L'énergie solaire offre de nombreux avantages. Elle est propre et renouvelable.
        Les coûts d'exploitation sont très bas après l'installation.
        Elle réduit les factures d'électricité et offre l'indépendance énergétique.
        Les panneaux solaires durent 25-30 ans avec peu d'entretien.
      expected_answer: "Los beneficios incluyen energía limpia, costos bajos, reducción de facturas, independencia energética, 25-30 años de vida"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0

  # GROUP 3: Same script family (Latin script)
  - description: "SAME-SCRIPT: DE doc -> EN question"
    vars:
      query: "What are the benefits of renewable energy?"
      context: |
        Erneuerbare Energien bieten viele Vorteile. Sie produzieren keine Treibhausgase.
        Die Betriebskosten sind niedrig. Sie schaffen Arbeitsplätze.
        Sie reduzieren die Abhängigkeit von fossilen Brennstoffen.
        Die Technologie wird ständig verbessert und günstiger.
      expected_answer: "Benefits include no greenhouse gases, low operating costs, job creation, reduced fossil fuel dependence"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0

  # GROUP 4: Different scripts (more challenging)
  - description: "DIFF-SCRIPT: EN doc -> AR question"
    vars:
      query: "ما هي فوائد الذكاء الاصطناعي؟"
      context: |
        Artificial Intelligence offers many benefits. It automates repetitive tasks.
        AI improves decision-making through data analysis. It enables personalized experiences.
        In healthcare, AI assists in diagnosis. In finance, it detects fraud.
        AI enhances productivity and creates new opportunities.
      expected_answer: "فوائد الذكاء الاصطناعي: أتمتة المهام، تحسين القرارات، تخصيص التجارب، التشخيص الطبي، كشف الاحتيال"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0

  - description: "DIFF-SCRIPT: JA doc -> EN question"
    vars:
      query: "What are the benefits of solar energy?"
      context: |
        太陽光エネルギーには多くの利点があります。クリーンで再生可能です。
        温室効果ガスを排出しません。運用コストが低いです。
        電気代を削減できます。25〜30年間使用できます。
        エネルギー独立性を提供します。
      expected_answer: "Solar energy is clean, renewable, no emissions, low operating costs, reduces bills, 25-30 year lifespan, energy independence"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0

  - description: "DIFF-SCRIPT: ZH doc -> EN question"
    vars:
      query: "What are the applications of blockchain?"
      context: |
        区块链技术有许多应用。在金融领域，它用于加密货币和跨境支付。
        供应链管理使用区块链追踪产品。医疗保健用它保护患者数据。
        智能合约自动执行协议。数字身份验证提高安全性。
        投票系统使用区块链确保透明度。
      expected_answer: "Blockchain applications: cryptocurrency, cross-border payments, supply chain tracking, healthcare data, smart contracts, digital identity, voting"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0

  # GROUP 5: Distant language pairs
  - description: "DISTANT: AR doc -> JA question"
    vars:
      query: "太陽エネルギーの利点は何ですか？"
      context: |
        الطاقة الشمسية لها فوائد عديدة. إنها نظيفة ومتجددة.
        لا تنتج انبعاثات. التكاليف التشغيلية منخفضة.
        تقلل فواتير الكهرباء. تدوم 25-30 سنة.
        توفر استقلال الطاقة.
      expected_answer: "太陽エネルギーの利点：クリーン、再生可能、排出ゼロ、低コスト、電気代削減、25-30年寿命"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0

  - description: "DISTANT: KO doc -> AR question"
    vars:
      query: "ما هي تطبيقات الذكاء الاصطناعي؟"
      context: |
        인공지능은 많은 응용 분야가 있습니다. 의료 분야에서 진단을 돕습니다.
        금융에서는 사기 탐지에 사용됩니다. 자율주행차에 필수적입니다.
        교육에서 개인화된 학습을 제공합니다. 제조업에서 품질 관리를 개선합니다.
      expected_answer: "تطبيقات الذكاء الاصطناعي: التشخيص الطبي، كشف الاحتيال، السيارات ذاتية القيادة، التعلم الشخصي، مراقبة الجودة"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0

  # GROUP 6: Technical content (often remains in English)
  - description: "TECHNICAL: Mixed tech doc -> ES question"
    vars:
      query: "¿Qué es una API REST?"
      context: |
        REST API is an architectural style for web services. Uses HTTP methods: GET, POST, PUT, DELETE.
        It's stateless - each request contains all information needed.
        Returns data in JSON or XML format. Uses standard HTTP status codes.
        Resources are identified by URIs.
      expected_answer: "REST API es un estilo arquitectónico para servicios web, usa métodos HTTP, es stateless, retorna JSON/XML"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0

  # GROUP 7: Poor context (testing lower bounds)
  - description: "POOR-CONTEXT: Minimal relevant EN doc -> ES question"
    vars:
      query: "¿Cómo funciona el aprendizaje automático?"
      context: |
        Machine learning uses algorithms. It involves data.
        Computers learn patterns.
      expected_answer: "El aprendizaje automático usa algoritmos, involucra datos, las computadoras aprenden patrones"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0

  - description: "POOR-CONTEXT: Partially relevant ES doc -> EN question"
    vars:
      query: "What is quantum computing?"
      context: |
        La computación cuántica es diferente de la clásica.
        Los ordenadores normales usan bits. 
        La tecnología está en desarrollo.
        Muchas empresas investigan esto.
      expected_answer: "Quantum computing is different from classical computing, uses different units than bits, technology in development"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0

  # GROUP 8: Excellent context (testing upper bounds)
  - description: "RICH-CONTEXT: Detailed EN doc -> FR question"
    vars:
      query: "Quels sont les avantages de l'énergie éolienne?"
      context: |
        Wind energy provides numerous benefits for society and environment.
        It produces zero emissions during operation, helping combat climate change.
        Wind is free and inexhaustible, providing energy security.
        Operating costs are very low after initial installation.
        Wind farms create jobs in manufacturing, installation, and maintenance.
        Land around turbines can still be used for farming.
        Technology improvements have reduced noise and increased efficiency.
        Offshore wind has enormous potential with stronger, more consistent winds.
        Wind energy reduces dependence on imported fossil fuels.
        It provides price stability as wind is free, unlike volatile fossil fuel prices.
      expected_answer: "L'énergie éolienne: zéro émissions, gratuite, sécurité énergétique, faibles coûts, création d'emplois, compatible avec agriculture, technologie améliorée, potentiel offshore, indépendance énergétique, stabilité des prix"
    assert:
      - type: context-faithfulness
        threshold: 0
      - type: context-relevance
        threshold: 0
      - type: context-recall
        value: "{{expected_answer}}"
        threshold: 0
