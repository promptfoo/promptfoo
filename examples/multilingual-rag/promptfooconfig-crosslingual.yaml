# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: Cross-lingual RAG evaluation with documents in one language and queries in another

prompts:
  - |
    You are a multilingual assistant. Answer the question using the provided context, even if they are in different languages.
    
    Question: {{query}}
    
    Context Documents:
    {{context}}
    
    Instructions:
    - Answer in the same language as the question
    - Use information from the context even if it's in a different language
    - Synthesize information accurately across languages

providers:
  # Using latest available models
  - openai:gpt-4o-mini
  - openai:gpt-4o
  - anthropic:messages:claude-3-5-haiku-20241022
  - anthropic:messages:claude-3-5-sonnet-20241022

defaultTest:
  assert:
    # These metrics will test cross-lingual understanding
    - type: context-faithfulness
      threshold: 0.7
    - type: context-relevance  
      threshold: 0.3
    - type: answer-relevance
      threshold: 0.7

tests:
  # Test 1: English questions with Spanish documents
  - description: "EN query -> ES documents: Climate change"
    vars:
      query: "What are the main causes of climate change?"
      context: |
        El cambio climático es causado principalmente por las emisiones de gases de efecto invernadero. 
        La quema de combustibles fósiles como el carbón, el petróleo y el gas natural libera dióxido de carbono (CO2) a la atmósfera.
        La deforestación reduce la capacidad de la Tierra para absorber CO2.
        La agricultura industrial y la ganadería producen metano, otro potente gas de efecto invernadero.
        El transporte, especialmente los automóviles y aviones, contribuye significativamente a las emisiones.
        Las actividades industriales y la producción de cemento también liberan grandes cantidades de CO2.
    assert:
      - type: factuality
        value: "Climate change is caused by greenhouse gas emissions from fossil fuels, deforestation, and agriculture"
      - type: context-recall
        value: "Main causes include burning fossil fuels, deforestation, agriculture producing methane, transportation, and industrial activities"
        threshold: 0.8
      - type: llm-rubric
        value: "The response should mention fossil fuels, deforestation, and agriculture as causes, based on the Spanish context"

  # Test 2: Spanish questions with English documents
  - description: "ES query -> EN documents: Artificial Intelligence"
    vars:
      query: "¿Cuáles son las aplicaciones principales de la inteligencia artificial?"
      context: |
        Artificial Intelligence has numerous applications across various industries.
        In healthcare, AI assists with disease diagnosis, drug discovery, and personalized treatment plans.
        Financial services use AI for fraud detection, risk assessment, and algorithmic trading.
        Transportation benefits from AI through autonomous vehicles and traffic optimization.
        In education, AI powers personalized learning platforms and intelligent tutoring systems.
        Manufacturing employs AI for predictive maintenance, quality control, and supply chain optimization.
        Customer service utilizes AI chatbots and virtual assistants for 24/7 support.
    assert:
      - type: factuality
        value: "La IA se aplica en salud, finanzas, transporte, educación, manufactura y servicio al cliente"
      - type: context-recall
        value: "Las aplicaciones incluyen diagnóstico médico, detección de fraude, vehículos autónomos, aprendizaje personalizado, mantenimiento predictivo"
        threshold: 0.8

  # Test 3: French questions with Japanese documents
  - description: "FR query -> JA documents: Renewable energy"
    vars:
      query: "Quels sont les avantages de l'énergie solaire?"
      context: |
        太陽光発電には多くの利点があります。
        第一に、太陽光は無限の資源であり、枯渇することがありません。
        太陽光パネルは温室効果ガスを排出せず、環境に優しいエネルギー源です。
        運用コストが低く、一度設置すれば20〜30年間使用できます。
        電気代を大幅に削減でき、余剰電力は売電できます。
        メンテナンスが簡単で、可動部品がないため故障が少ないです。
        災害時の非常用電源としても活用できます。
    assert:
      - type: context-faithfulness
        threshold: 0.7
      - type: answer-relevance
        threshold: 0.8
      - type: llm-rubric
        value: "Response should mention: infinite resource, no greenhouse gases, low operating costs, 20-30 year lifespan, reduced electricity bills"

  # Test 4: German questions with Chinese documents
  - description: "DE query -> ZH documents: Electric vehicles"
    vars:
      query: "Welche Vorteile haben Elektrofahrzeuge gegenüber Benzinfahrzeugen?"
      context: |
        电动汽车相比传统汽油车有许多优势。
        首先，电动汽车零排放，有助于减少空气污染和温室气体排放。
        运营成本更低，因为电力比汽油便宜，维护需求也更少。
        电动汽车更安静，减少了噪音污染。
        能量效率更高，电动机的效率可达90%，而内燃机只有20-30%。
        可以在家充电，提供了更大的便利性。
        许多国家提供购买补贴和税收优惠。
        加速性能优越，扭矩输出即时。
    assert:
      - type: factuality
        value: "Elektrofahrzeuge haben keine Emissionen, niedrigere Betriebskosten, sind leiser und energieeffizienter"
      - type: context-recall
        value: "Vorteile: keine Emissionen, niedrigere Kosten, weniger Wartung, leiser, 90% Effizienz, Heimladung, Subventionen, bessere Beschleunigung"
        threshold: 0.75

  # Test 5: Japanese questions with Arabic documents
  - description: "JA query -> AR documents: Space exploration"
    vars:
      query: "宇宙探査の主な目的は何ですか？"
      context: |
        لاستكشاف الفضاء أهداف متعددة ومهمة للبشرية.
        البحث العلمي هو الهدف الأساسي، حيث نسعى لفهم أصل الكون وتطوره.
        البحث عن حياة خارج الأرض يدفع العديد من المهمات الفضائية.
        تطوير التكنولوجيا المتقدمة التي تفيد الحياة على الأرض.
        استخراج الموارد من الكويكبات والكواكب الأخرى في المستقبل.
        ضمان بقاء الجنس البشري من خلال استعمار كواكب أخرى.
        التعاون الدولي وتعزيز السلام بين الأمم.
        إلهام الأجيال القادمة لدراسة العلوم والتكنولوجيا.
    assert:
      - type: context-faithfulness
        threshold: 0.65
      - type: answer-relevance
        threshold: 0.75

  # Test 6: Chinese questions with French documents
  - description: "ZH query -> FR documents: Machine learning"
    vars:
      query: "机器学习的主要算法类型有哪些？"
      context: |
        L'apprentissage automatique comprend plusieurs types d'algorithmes principaux.
        L'apprentissage supervisé utilise des données étiquetées pour entraîner des modèles. Il inclut la classification et la régression.
        L'apprentissage non supervisé découvre des patterns dans des données non étiquetées, comme le clustering et la réduction de dimensionnalité.
        L'apprentissage par renforcement permet aux agents d'apprendre par interaction avec l'environnement.
        L'apprentissage semi-supervisé combine des données étiquetées et non étiquetées.
        L'apprentissage profond utilise des réseaux de neurones avec de nombreuses couches.
        Les méthodes d'ensemble combinent plusieurs modèles pour améliorer les performances.
    assert:
      - type: factuality
        value: "机器学习包括监督学习、非监督学习、强化学习、半监督学习和深度学习"
      - type: context-recall
        value: "算法类型：监督学习（分类、回归）、非监督学习（聚类）、强化学习、半监督学习、深度学习、集成方法"
        threshold: 0.8

  # Test 7: Arabic questions with Portuguese documents
  - description: "AR query -> PT documents: Sustainable development"
    vars:
      query: "ما هي أهداف التنمية المستدامة الرئيسية؟"
      context: |
        O desenvolvimento sustentável tem objetivos fundamentais para o futuro da humanidade.
        Erradicar a pobreza em todas as suas formas é o primeiro objetivo.
        Garantir segurança alimentar e promover agricultura sustentável.
        Assegurar educação de qualidade inclusiva e equitativa para todos.
        Alcançar a igualdade de gênero e empoderar mulheres e meninas.
        Garantir acesso à água limpa e saneamento para todos.
        Assegurar energia limpa e acessível.
        Promover crescimento econômico sustentável e trabalho decente.
        Combater as mudanças climáticas e seus impactos.
        Proteger os ecossistemas terrestres e marinhos.
        Promover sociedades pacíficas e justas.
    assert:
      - type: context-faithfulness
        threshold: 0.7
      - type: answer-relevance
        threshold: 0.75

  # Test 8: Korean questions with German documents
  - description: "KO query -> DE documents: Quantum computing"
    vars:
      query: "양자 컴퓨팅의 주요 응용 분야는 무엇입니까?"
      context: |
        Quantencomputer haben revolutionäre Anwendungsmöglichkeiten in verschiedenen Bereichen.
        In der Kryptographie können sie bestehende Verschlüsselungen brechen, aber auch neue, sichere Methoden entwickeln.
        Die Medikamentenentwicklung profitiert von der Simulation molekularer Interaktionen.
        Finanzmodellierung und Risikobewertung werden durch Quantenalgorithmen verbessert.
        Materialwissenschaft nutzt Quantensimulationen für neue Materialien.
        Optimierungsprobleme in Logistik und Verkehr können effizienter gelöst werden.
        Künstliche Intelligenz und maschinelles Lernen werden durch Quantenalgorithmen beschleunigt.
        Wettervorhersage und Klimamodellierung werden präziser.
    assert:
      - type: factuality
        value: "양자 컴퓨팅은 암호학, 약물 개발, 금융 모델링, 재료 과학, 최적화, AI에 응용됩니다"
      - type: context-recall
        value: "응용: 암호학, 약물 개발, 금융 모델링, 재료 과학, 물류 최적화, AI/ML, 날씨 예측"
        threshold: 0.75

  # Test 9: Portuguese questions with Hindi documents
  - description: "PT query -> HI documents: Digital transformation"
    vars:
      query: "Quais são os principais desafios da transformação digital?"
      context: |
        डिजिटल परिवर्तन में कई चुनौतियां हैं।
        पुरानी प्रणालियों का आधुनिकीकरण महंगा और जटिल है।
        कर्मचारियों का प्रतिरोध और नई तकनीक सीखने की आवश्यकता।
        साइबर सुरक्षा जोखिम और डेटा गोपनीयता की चिंताएं।
        उच्च प्रारंभिक निवेश और अनिश्चित ROI।
        विभिन्न विभागों के बीच समन्वय की कमी।
        उपयुक्त कौशल वाले पेशेवरों की कमी।
        नियामक अनुपालन और कानूनी चुनौतियां।
        ग्राहकों की बदलती अपेक्षाएं।
    assert:
      - type: context-faithfulness
        threshold: 0.65
      - type: answer-relevance
        threshold: 0.7

  # Test 10: Hindi questions with Spanish documents
  - description: "HI query -> ES documents: Biodiversity"
    vars:
      query: "जैव विविधता के संरक्षण के मुख्य तरीके क्या हैं?"
      context: |
        La conservación de la biodiversidad requiere múltiples estrategias.
        Establecer áreas protegidas y parques nacionales es fundamental.
        Restauración de hábitats degradados y corredores ecológicos.
        Control de especies invasoras que amenazan ecosistemas nativos.
        Programas de reproducción en cautiverio para especies en peligro.
        Educación ambiental y concienciación pública.
        Uso sostenible de recursos naturales.
        Investigación científica y monitoreo de especies.
        Cooperación internacional y tratados de conservación.
        Integración de comunidades locales en la conservación.
        Bancos de semillas y conservación ex-situ.
    assert:
      - type: factuality
        value: "जैव विविधता संरक्षण: संरक्षित क्षेत्र, आवास बहाली, आक्रामक प्रजाति नियंत्रण, कैप्टिव प्रजनन"
      - type: context-recall
        value: "संरक्षण: संरक्षित क्षेत्र, आवास बहाली, आक्रामक प्रजाति नियंत्रण, कैप्टिव प्रजनन, शिक्षा, अनुसंधान, अंतर्राष्ट्रीय सहयोग"
        threshold: 0.7

  # Test 11: Mixed scenario - English query with documents in multiple languages
  - description: "EN query -> Multi-language documents: Global warming solutions"
    vars:
      query: "What are the most effective solutions to combat global warming?"
      context: |
        Les énergies renouvelables sont essentielles pour réduire les émissions de CO2.
        植树造林可以吸收大气中的二氧化碳。
        La eficiencia energética en edificios reduce el consumo.
        電気自動車への移行は輸送部門の排出を削減します。
        Nachhaltige Landwirtschaft verringert Methanemissionen.
        تطوير تقنيات احتجاز الكربون وتخزينه.
        국제 협력과 탄소세 도입이 필요합니다.
        Mudança para dietas baseadas em plantas reduz impacto ambiental.
    assert:
      - type: context-faithfulness
        threshold: 0.6
      - type: answer-relevance
        threshold: 0.75
      - type: llm-rubric
        value: "Response should synthesize solutions from multiple languages: renewable energy, reforestation, energy efficiency, electric vehicles, sustainable agriculture, carbon capture, international cooperation, plant-based diets"

  # Test 12: Complex technical cross-lingual with code
  - description: "EN query -> Mixed language technical documentation"
    vars:
      query: "How do you implement a REST API with authentication?"
      context: |
        Pour implémenter une API REST avec authentification:
        1. Utilisez JWT (JSON Web Tokens) pour l'authentification stateless
        2. Implementieren Sie HTTPS für sichere Kommunikation
        3. 使用中间件验证令牌:
        ```javascript
        const verifyToken = (req, res, next) => {
          const token = req.headers['authorization'];
          jwt.verify(token, secret, (err, decoded) => {
            if (err) return res.status(401).json({error: '未授权'});
            req.user = decoded;
            next();
          });
        };
        ```
        4. Implementar rate limiting para prevenir ataques
        5. ユーザーの権限を確認してアクセス制御を実装
    assert:
      - type: context-faithfulness
        threshold: 0.75
      - type: answer-relevance
        threshold: 0.8
      - type: llm-rubric
        value: "Should mention JWT, HTTPS, middleware for token verification, rate limiting, and access control"

  # Test 13: Scientific cross-lingual
  - description: "FR query -> EN/DE/JA scientific documents"
    vars:
      query: "Qu'est-ce que CRISPR et comment fonctionne-t-il?"
      context: |
        CRISPR-Cas9 is a revolutionary gene-editing technology derived from bacterial immune systems.
        It uses a guide RNA to target specific DNA sequences.
        Das Cas9-Protein schneidet die DNA an der Zielstelle wie eine molekulare Schere.
        切断されたDNAは、細胞の修復メカニズムによって修復されます。
        This repair process can be used to delete genes, insert new sequences, or correct mutations.
        Die Technologie hat Anwendungen in der Medizin, Landwirtschaft und Biotechnologie.
        遺伝病の治療、作物の改良、新薬の開発に使用されています。
    assert:
      - type: factuality
        value: "CRISPR utilise un ARN guide et la protéine Cas9 pour couper l'ADN et permettre l'édition génétique"
      - type: context-recall
        value: "CRISPR: système immunitaire bactérien, ARN guide, Cas9 coupe l'ADN, réparation cellulaire, applications médicales et agricoles"
        threshold: 0.8

  # Test 14: Historical cross-lingual
  - description: "ES query -> Multi-language historical documents"
    vars:
      query: "¿Cuáles fueron las causas principales de la Segunda Guerra Mundial?"
      context: |
        第一次世界大戦後のヴェルサイユ条約がドイツに厳しい制裁を課しました。
        The global economic depression of the 1930s created political instability.
        L'ascension d'Hitler et du nazisme en Allemagne a militarisé le pays.
        La politica di appeasement delle potenze occidentali fallì nel fermare l'aggressione.
        日本の帝国主義的拡大がアジアで緊張を高めました。
        Der Molotow-Ribbentrop-Pakt zwischen Deutschland und der Sowjetunion.
        O fracasso da Liga das Nações em manter a paz internacional.
    assert:
      - type: context-faithfulness
        threshold: 0.7
      - type: answer-relevance
        threshold: 0.75
      - type: llm-rubric
        value: "Should mention: Treaty of Versailles, economic depression, rise of Hitler/Nazism, appeasement failure, Japanese imperialism, Molotov-Ribbentrop Pact, League of Nations failure"

  # Test 15: Business/Economics cross-lingual
  - description: "ZH query -> EN/ES/DE business documents"
    vars:
      query: "什么是敏捷项目管理方法？"
      context: |
        Agile project management emphasizes iterative development and continuous feedback.
        Los equipos trabajan en sprints cortos de 1-4 semanas.
        Key principles include: individuals over processes, working software over documentation.
        Die täglichen Stand-up-Meetings fördern Kommunikation und Transparenz.
        El product owner prioriza el backlog según el valor del negocio.
        Scrum Master facilitates the process and removes impediments.
        Retrospektiven am Ende jedes Sprints verbessern kontinuierlich den Prozess.
        La colaboración con el cliente es más importante que la negociación de contratos.
    assert:
      - type: factuality
        value: "敏捷方法包括迭代开发、短期冲刺、每日站会、产品负责人和Scrum Master角色"
      - type: context-recall
        value: "敏捷：迭代开发、1-4周冲刺、每日站会、产品负责人、Scrum Master、回顾会议、客户协作"
        threshold: 0.8
