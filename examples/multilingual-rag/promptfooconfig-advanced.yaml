# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json
description: 'Advanced Multi-lingual RAG Evaluation - Testing edge cases and specific capabilities'

prompts:
  # Standard RAG prompt
  - id: standard-rag
    file://prompts/standard-rag.txt
  
  # RAG with explicit language instruction
  - id: explicit-language
    file://prompts/explicit-language.txt

providers:
  - id: gpt-4o-mini
    config:
      id: openai:gpt-4o-mini
      temperature: 0.1
  
  - id: gpt-4o
    config:
      id: openai:gpt-4o
      temperature: 0.1
      
  - id: claude-haiku
    config:
      id: anthropic:messages:claude-3-5-haiku-20241022
      temperature: 0.1

# Test different scoring models for multilingual grading
derivedMetrics:
  - name: avg_faithfulness
    value: (context_faithfulness_pass_rate)
  - name: avg_relevance
    value: (context_relevance_pass_rate + answer_relevance_pass_rate) / 2
  - name: avg_recall
    value: (context_recall_pass_rate)

defaultTest:
  options:
    rubricProvider: openai:gpt-4o  # Use GPT-4 for grading multilingual content
  assert:
    # Test all RAG metrics with different thresholds
    - type: context-faithfulness
      threshold: 0.75
    - type: context-relevance
      threshold: 0.25
    - type: answer-relevance
      threshold: 0.75

tests:
  # Test 1: Technical terminology across languages
  - description: "Technical AI/ML terminology - English"
    vars:
      query: "What is a neural network and how does backpropagation work?"
      context: |
        A neural network is a computational model inspired by biological neural networks. It consists of layers of interconnected nodes (neurons) that process information. Each connection has a weight that gets adjusted during training.
        
        Backpropagation is the key algorithm for training neural networks. It calculates the gradient of the loss function with respect to each weight by using the chain rule, efficiently computing gradients layer by layer from the output back to the input.
        
        The process involves: forward pass (computing outputs), calculating loss, backward pass (computing gradients), and updating weights using gradient descent.
    assert:
      - type: factuality
        value: "Neural networks use backpropagation to adjust weights through gradient descent"
      - type: context-recall
        value: "Backpropagation uses the chain rule to compute gradients layer by layer"
        threshold: 0.9

  - description: "Technical AI/ML terminology - Japanese"
    vars:
      query: "ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿãƒãƒƒã‚¯ãƒ—ãƒ­ãƒ‘ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã©ã®ã‚ˆã†ã«æ©Ÿèƒ½ã—ã¾ã™ã‹ï¼Ÿ"
      context: |
        ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ã€ç”Ÿç‰©å­¦çš„ãªç¥çµŒå›è·¯ç¶²ã«ç€æƒ³ã‚’å¾—ãŸè¨ˆç®—ãƒ¢ãƒ‡ãƒ«ã§ã™ã€‚æƒ…å ±ã‚’å‡¦ç†ã™ã‚‹ç›¸äº’æ¥ç¶šã•ã‚ŒãŸãƒãƒ¼ãƒ‰ï¼ˆãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ³ï¼‰ã®å±¤ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚å„æ¥ç¶šã«ã¯ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ä¸­ã«èª¿æ•´ã•ã‚Œã‚‹é‡ã¿ãŒã‚ã‚Šã¾ã™ã€‚
        
        ãƒãƒƒã‚¯ãƒ—ãƒ­ãƒ‘ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆèª¤å·®é€†ä¼æ’­æ³•ï¼‰ã¯ã€ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’è¨“ç·´ã™ã‚‹ãŸã‚ã®é‡è¦ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã™ã€‚é€£é–å¾‹ã‚’ä½¿ç”¨ã—ã¦ã€å„é‡ã¿ã«å¯¾ã™ã‚‹æå¤±é–¢æ•°ã®å‹¾é…ã‚’è¨ˆç®—ã—ã€å‡ºåŠ›ã‹ã‚‰å…¥åŠ›ã¾ã§å±¤ã”ã¨ã«åŠ¹ç‡çš„ã«å‹¾é…ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
        
        ãƒ—ãƒ­ã‚»ã‚¹ã«ã¯ä»¥ä¸‹ãŒå«ã¾ã‚Œã¾ã™ï¼šé †ä¼æ’­ï¼ˆå‡ºåŠ›ã®è¨ˆç®—ï¼‰ã€æå¤±ã®è¨ˆç®—ã€é€†ä¼æ’­ï¼ˆå‹¾é…ã®è¨ˆç®—ï¼‰ã€å‹¾é…é™ä¸‹æ³•ã‚’ä½¿ç”¨ã—ãŸé‡ã¿ã®æ›´æ–°ã€‚
    assert:
      - type: factuality
        value: "ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯å‹¾é…é™ä¸‹æ³•ã‚’é€šã˜ã¦é‡ã¿ã‚’èª¿æ•´ã™ã‚‹ãŸã‚ã«ãƒãƒƒã‚¯ãƒ—ãƒ­ãƒ‘ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹"
      - type: context-recall
        value: "ãƒãƒƒã‚¯ãƒ—ãƒ­ãƒ‘ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¯é€£é–å¾‹ã‚’ä½¿ç”¨ã—ã¦å±¤ã”ã¨ã«å‹¾é…ã‚’è¨ˆç®—ã™ã‚‹"
        threshold: 0.9

  # Test 2: Code-switching and mixed language content
  - description: "Code-switching in context"
    vars:
      query: "How do I implement a REST API?"
      context: |
        To implement a REST API, you need to follow REST principles. RESTï¼ˆRepresentational State Transferï¼‰æ˜¯ä¸€ç§æ¶æ„é£æ ¼ã€‚
        
        Key components include:
        - Endpoints (URLs) that represent resources
        - HTTP methods: GETï¼ˆè·å–ï¼‰, POSTï¼ˆåˆ›å»ºï¼‰, PUTï¼ˆæ›´æ–°ï¼‰, DELETEï¼ˆåˆ é™¤ï¼‰
        - Status codes: 200 (OK), 404 (Not Found), 500 (Server Error)
        - JSON ou XML pour le format des donnÃ©es
        - AutenticaciÃ³n mediante tokens (JWT ãŒä¸€èˆ¬çš„ã§ã™)
    assert:
      - type: context-faithfulness
        threshold: 0.7
      - type: answer-relevance
        threshold: 0.8

  # Test 3: Cultural context and idiomatic expressions
  - description: "Cultural idioms - English"
    vars:
      query: "What does 'it's raining cats and dogs' mean?"
      context: |
        The English idiom "it's raining cats and dogs" means it's raining very heavily. This is a colloquial expression used in casual conversation. The origin is uncertain, but it dates back to at least the 17th century. Similar expressions exist in other languages with different imagery.
    assert:
      - type: factuality
        value: "The idiom means heavy rain"

  - description: "Cultural idioms - Spanish"
    vars:
      query: "Â¿QuÃ© significa 'estar en las nubes'?"
      context: |
        La expresiÃ³n espaÃ±ola "estar en las nubes" significa estar distraÃ­do o no prestar atenciÃ³n a lo que sucede alrededor. Es similar a la expresiÃ³n inglesa "to have one's head in the clouds". Se usa cuando alguien estÃ¡ soÃ±ando despierto o pensando en otras cosas.
    assert:
      - type: factuality
        value: "La expresiÃ³n significa estar distraÃ­do o soÃ±ando despierto"

  # Test 4: Numeric and date formats across cultures
  - description: "Numeric formats - European"
    vars:
      query: "What is the population and GDP of Germany?"
      context: |
        Germany has a population of 83.240.525 people (2023 estimate). The GDP is â‚¬4.121.000.000.000 (4,121 trillion euros) as of 2023. The unemployment rate is 5,7%. The country was reunified on 03.10.1990.
    assert:
      - type: factuality
        value: "Germany has over 83 million people and a GDP over 4 trillion euros"
      - type: context-recall
        value: "Germany was reunified in October 1990"
        threshold: 1.0

  - description: "Numeric formats - American"
    vars:
      query: "What is the population and GDP of the United States?"
      context: |
        The United States has a population of 335,893,238 people (2024 estimate). The GDP is $27,360,000,000,000 (27.36 trillion dollars) as of 2024. The unemployment rate is 3.9%. Independence was declared on 07/04/1776.
    assert:
      - type: factuality
        value: "The US has over 335 million people and a GDP over 27 trillion dollars"
      - type: context-recall
        value: "The United States declared independence in July 1776"
        threshold: 1.0

  # Test 5: Right-to-left languages
  - description: "RTL language - Arabic"
    vars:
      query: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ù…ØµØ± ÙˆÙ…Ø§ Ù‡Ùˆ ØªØ§Ø±ÙŠØ®Ù‡Ø§ØŸ"
      context: |
        Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ù…ØµØ± ÙˆØ£ÙƒØ¨Ø± Ù…Ø¯Ù†Ù‡Ø§. ØªØ£Ø³Ø³Øª ÙÙŠ Ø¹Ø§Ù… 969 Ù…ÙŠÙ„Ø§Ø¯ÙŠ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„ÙØ§Ø·Ù…ÙŠÙŠÙ†. ÙŠØ¨Ù„Øº Ø¹Ø¯Ø¯ Ø³ÙƒØ§Ù†Ù‡Ø§ Ø­ÙˆØ§Ù„ÙŠ 10 Ù…Ù„Ø§ÙŠÙŠÙ† Ù†Ø³Ù…Ø©. ØªÙØ¹Ø±Ù Ø¨Ù€"Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø£Ù„Ù Ù…Ø¦Ø°Ù†Ø©" Ù„ÙƒØ«Ø±Ø© Ù…Ø³Ø§Ø¬Ø¯Ù‡Ø§. ØªØ¶Ù… Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ø§Ù„Ù… Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© Ù…Ø«Ù„ Ø§Ù„Ø£Ù‡Ø±Ø§Ù…Ø§Øª ÙˆØ£Ø¨Ùˆ Ø§Ù„Ù‡ÙˆÙ„.
    assert:
      - type: factuality
        value: "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ù…ØµØ± ÙˆØªØ£Ø³Ø³Øª Ø¹Ø§Ù… 969"
      - type: context-recall
        value: "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© ØªÙØ¹Ø±Ù Ø¨Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø£Ù„Ù Ù…Ø¦Ø°Ù†Ø© ÙˆØªØ¶Ù… Ø§Ù„Ø£Ù‡Ø±Ø§Ù…Ø§Øª"
        threshold: 0.8

  - description: "RTL language - Hebrew"
    vars:
      query: "××”×™ ×‘×™×¨×ª ×™×©×¨××œ ×•××” ×”×”×™×¡×˜×•×¨×™×” ×©×œ×”?"
      context: |
        ×™×¨×•×©×œ×™× ×”×™× ×‘×™×¨×ª ×™×©×¨××œ. ×”×™× ××—×ª ×”×¢×¨×™× ×”×¢×ª×™×§×•×ª ×‘×¢×•×œ× ×¢× ×”×™×¡×˜×•×¨×™×” ×©×œ ×œ××¢×œ×” ×-3000 ×©× ×”. ×”××•×›×œ×•×¡×™×™×” ××•× ×” ×›-950,000 ×ª×•×©×‘×™×. ×”×¢×™×¨ ×§×“×•×©×” ×œ×©×œ×•×© ×”×“×ª×•×ª ×”××•× ×•×ª××™×¡×˜×™×•×ª: ×™×”×“×•×ª, × ×¦×¨×•×ª ×•××¡×œ××. ×”×¢×™×¨ ×”×¢×ª×™×§×” × ×›×œ×œ×ª ×‘×¨×©×™××ª ××ª×¨×™ ××•×¨×©×ª ×¢×•×œ××™×ª ×©×œ ××•× ×¡×§"×•.
    assert:
      - type: factuality
        value: "×™×¨×•×©×œ×™× ×”×™× ×‘×™×¨×ª ×™×©×¨××œ ×¢× ×”×™×¡×˜×•×¨×™×” ×©×œ ×œ××¢×œ×” ×-3000 ×©× ×”"
      - type: context-recall
        value: "×™×¨×•×©×œ×™× ×§×“×•×©×” ×œ×©×œ×•×© ×“×ª×•×ª ×•×”×¢×™×¨ ×”×¢×ª×™×§×” ×”×™× ××ª×¨ ××•×¨×©×ª ×¢×•×œ××™×ª"
        threshold: 0.8

  # Test 6: Character-based languages (Chinese, Japanese Kanji)
  - description: "Chinese characters - Simplified"
    vars:
      query: "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½çš„ä¸»è¦åº”ç”¨é¢†åŸŸï¼Ÿ"
      context: |
        äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰åœ¨è®¸å¤šé¢†åŸŸéƒ½æœ‰é‡è¦åº”ç”¨ï¼š
        1. åŒ»ç–—ä¿å¥ï¼šç–¾ç—…è¯Šæ–­ã€è¯ç‰©å‘ç°ã€ä¸ªæ€§åŒ–æ²»ç–—
        2. é‡‘èï¼šé£é™©è¯„ä¼°ã€æ¬ºè¯ˆæ£€æµ‹ã€ç®—æ³•äº¤æ˜“
        3. äº¤é€šè¿è¾“ï¼šè‡ªåŠ¨é©¾é©¶æ±½è½¦ã€äº¤é€šä¼˜åŒ–
        4. æ•™è‚²ï¼šä¸ªæ€§åŒ–å­¦ä¹ ã€æ™ºèƒ½è¾…å¯¼ç³»ç»Ÿ
        5. åˆ¶é€ ä¸šï¼šé¢„æµ‹æ€§ç»´æŠ¤ã€è´¨é‡æ§åˆ¶ã€ä¾›åº”é“¾ä¼˜åŒ–
    assert:
      - type: context-recall
        value: "äººå·¥æ™ºèƒ½åº”ç”¨äºåŒ»ç–—ä¿å¥ã€é‡‘èã€äº¤é€šè¿è¾“ã€æ•™è‚²å’Œåˆ¶é€ ä¸š"
        threshold: 0.9

  - description: "Chinese characters - Traditional"
    vars:
      query: "ä»€éº¼æ˜¯äººå·¥æ™ºæ…§çš„ä¸»è¦æ‡‰ç”¨é ˜åŸŸï¼Ÿ"
      context: |
        äººå·¥æ™ºæ…§ï¼ˆAIï¼‰åœ¨è¨±å¤šé ˜åŸŸéƒ½æœ‰é‡è¦æ‡‰ç”¨ï¼š
        1. é†«ç™‚ä¿å¥ï¼šç–¾ç—…è¨ºæ–·ã€è—¥ç‰©ç™¼ç¾ã€å€‹æ€§åŒ–æ²»ç™‚
        2. é‡‘èï¼šé¢¨éšªè©•ä¼°ã€æ¬ºè©æª¢æ¸¬ã€æ¼”ç®—æ³•äº¤æ˜“
        3. äº¤é€šé‹è¼¸ï¼šè‡ªå‹•é§•é§›æ±½è»Šã€äº¤é€šå„ªåŒ–
        4. æ•™è‚²ï¼šå€‹æ€§åŒ–å­¸ç¿’ã€æ™ºèƒ½è¼”å°ç³»çµ±
        5. è£½é€ æ¥­ï¼šé æ¸¬æ€§ç¶­è­·ã€å“è³ªæ§åˆ¶ã€ä¾›æ‡‰éˆå„ªåŒ–
    assert:
      - type: context-recall
        value: "äººå·¥æ™ºæ…§æ‡‰ç”¨æ–¼é†«ç™‚ä¿å¥ã€é‡‘èã€äº¤é€šé‹è¼¸ã€æ•™è‚²å’Œè£½é€ æ¥­"
        threshold: 0.9

  # Test 7: Dialectal variations
  - description: "Portuguese - Brazilian"
    vars:
      query: "Como funciona o sistema de transporte pÃºblico em SÃ£o Paulo?"
      context: |
        SÃ£o Paulo possui um dos maiores sistemas de transporte pÃºblico da AmÃ©rica Latina. O metrÃ´ tem 6 linhas e 91 estaÃ§Ãµes. Os Ã´nibus municipais operam mais de 1.300 linhas. O Bilhete Ãšnico permite integraÃ§Ã£o entre diferentes modais. Nos horÃ¡rios de pico, o sistema transporta milhÃµes de passageiros. A CPTM opera trens metropolitanos que conectam a regiÃ£o metropolitana.
    assert:
      - type: factuality
        value: "O metrÃ´ de SÃ£o Paulo tem 6 linhas e o Bilhete Ãšnico permite integraÃ§Ã£o"

  - description: "Portuguese - European"
    vars:
      query: "Como funciona o sistema de transportes pÃºblicos em Lisboa?"
      context: |
        Lisboa tem um sistema de transportes pÃºblicos diversificado. O metropolitano tem 4 linhas e 56 estaÃ§Ãµes. Os autocarros da Carris cobrem toda a cidade. Os elÃ©tricos sÃ£o icÃ³nicos e servem rotas turÃ­sticas e regulares. O passe navegante permite utilizar todos os transportes. A CP opera comboios suburbanos. Os barcos da Transtejo ligam as duas margens do Tejo.
    assert:
      - type: factuality
        value: "O metropolitano de Lisboa tem 4 linhas e o passe navegante permite usar todos os transportes"

  # Test 8: Emoji and special characters
  - description: "Content with emojis"
    vars:
      query: "What are the benefits of exercise?"
      context: |
        Regular exercise provides numerous benefits ğŸ’ª:
        â€¢ â¤ï¸ Cardiovascular health: Strengthens heart and improves circulation
        â€¢ ğŸ§  Mental health: Reduces stress, anxiety, and depression
        â€¢ ğŸ’¤ Better sleep quality
        â€¢ âš–ï¸ Weight management
        â€¢ ğŸ¦´ Stronger bones and muscles
        â€¢ ğŸ¯ Improved focus and cognitive function
        Remember: 30 minutes of exercise, 5 days a week is recommended! ğŸƒâ€â™€ï¸ğŸƒâ€â™‚ï¸
    assert:
      - type: context-faithfulness
        threshold: 0.8
      - type: answer-relevance
        threshold: 0.8

  # Test 9: Language detection and appropriate response
  - description: "Automatic language detection"
    vars:
      query: "Comment fonctionne le machine learning?"
      context: |
        Machine learning is a subset of artificial intelligence that enables systems to learn from data. 
        Le processus comprend: collecte de donnÃ©es, prÃ©paration, choix du modÃ¨le, entraÃ®nement, validation.
        Los algoritmos comunes incluyen: regresiÃ³n, Ã¡rboles de decisiÃ³n, redes neuronales.
        æ©Ÿæ¢°å­¦ç¿’ã¯å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’ã—ã¾ã™ã€‚
    assert:
      - type: answer-relevance
        threshold: 0.7
      - type: llm-rubric
        value: "The response should be primarily in French since the question is in French"

  # Test 10: Complex multilingual scenario
  - description: "International business context"
    vars:
      query: "What are the key considerations for expanding a business internationally?"
      context: |
        International expansion requires careful planning across multiple dimensions:
        
        Legal: Each country has different æ³•å¾‹ (laws) and rÃ©glementations. GDPR in EU, ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³• in China.
        
        Cultural: Understanding local customs is crucial. In Japan, ååˆºäº¤æ› (business card exchange) follows specific protocol. In Middle East, Ø§Ù„Ø¬Ù…Ø¹Ø© (Friday) is often a day off.
        
        Financial: Currency risk (â‚¬/$/ ØªØ­ÙˆÙŠÙ„), tax implications (VAT/GST/æ¶ˆè²»ç¨), and transfer pricing.
        
        Language: Localization goes beyond translation. "Slogan" might need complete rework. Colors have different meanings (ç™½ means death in some Asian cultures, luck in others).
        
        Market: Local competition, consumer preferences (Germans prefer Datenschutz, Americans value convenience).
    assert:
      - type: context-faithfulness
        threshold: 0.75
      - type: context-recall
        value: "International expansion requires consideration of legal, cultural, financial, language, and market factors"
        threshold: 0.9
      - type: answer-relevance
        threshold: 0.85
