# Tool calling with Llama API
# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json

description: Tool calling capabilities with Llama API models

providers:
  - id: llamaapi:Llama-3.3-70B-Instruct
    config:
      temperature: 0.3
      tools:
        - type: function
          function:
            name: get_weather
            description: Get the current weather for a location
            parameters:
              type: object
              properties:
                location:
                  type: string
                  description: The city and state, e.g. San Francisco, CA
                unit:
                  type: string
                  enum: ['celsius', 'fahrenheit']
                  description: Temperature unit
              required: ['location']

        - type: function
          function:
            name: calculate_tip
            description: Calculate tip amount for a bill
            parameters:
              type: object
              properties:
                bill_amount:
                  type: number
                  description: The total bill amount
                tip_percentage:
                  type: number
                  description: The tip percentage (e.g., 18 for 18%)
              required: ['bill_amount', 'tip_percentage']

        - type: function
          function:
            name: send_email
            description: Send an email to a recipient
            parameters:
              type: object
              properties:
                to:
                  type: string
                  description: Email address of recipient
                subject:
                  type: string
                  description: Email subject
                body:
                  type: string
                  description: Email body content
              required: ['to', 'subject', 'body']

  - id: llamaapi:Llama-4-Maverick-17B-128E-Instruct-FP8
    config:
      temperature: 0.3
      tools:
        - type: function
          function:
            name: analyze_image
            description: Analyze an image and provide insights
            parameters:
              type: object
              properties:
                image_url:
                  type: string
                  description: URL of the image to analyze
                analysis_type:
                  type: string
                  enum: ['objects', 'colors', 'text', 'general']
                  description: Type of analysis to perform
              required: ['image_url']

prompts:
  - '{{query}}'

tests:
  - vars:
      query: "What's the weather like in New York, NY?"
    assert:
      - type: function-call
        value: get_weather
      - type: javascript
        value: "typeof output === 'object' && output.name === 'get_weather'"
      - type: javascript
        value: "output.arguments.location.toLowerCase().includes('new york')"

  - vars:
      query: 'I need to calculate an 18% tip on a $85 dinner bill.'
    assert:
      - type: function-call
        value: calculate_tip
      - type: javascript
        value: "typeof output === 'object' && output.name === 'calculate_tip'"
      - type: javascript
        value: 'output.arguments.bill_amount == 85'
      - type: javascript
        value: 'output.arguments.tip_percentage == 18'

  - vars:
      query: "Send an email to john@example.com with subject 'Meeting Tomorrow' and tell him we need to reschedule our 3 PM meeting."
    assert:
      - type: function-call
        value: send_email
      - type: javascript
        value: "typeof output === 'object' && output.name === 'send_email'"
      - type: javascript
        value: "output.arguments.to === 'john@example.com'"
      - type: javascript
        value: "output.arguments.subject.includes('Meeting Tomorrow')"

  - vars:
      query: "Can you help me understand what's happening in this image? https://example.com/photo.jpg"
    assert:
      - type: function-call
        value: analyze_image
      - type: javascript
        value: "typeof output === 'object' && output.name === 'analyze_image'"
      - type: javascript
        value: "output.arguments.image_url.includes('example.com/photo.jpg')"
