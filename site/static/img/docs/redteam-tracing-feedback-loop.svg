<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600" style="max-width: 100%; height: auto;">
  <defs>
    <style>
      .title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 16px; font-weight: 600; fill: #1a202c; }
      .label { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 14px; fill: #2d3748; }
      .sublabel { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 12px; fill: #4a5568; }
      .trace-text { font-family: 'SF Mono', Monaco, 'Courier New', monospace; font-size: 10px; fill: #2d3748; }
      .step-number { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 13px; font-weight: 600; fill: #fff; }
      .arrow { fill: none; stroke: #4a5568; stroke-width: 2; marker-end: url(#arrowhead); }
      .feedback-arrow { fill: none; stroke: #059669; stroke-width: 2.5; marker-end: url(#arrowhead-feedback); stroke-dasharray: 5,3; }
      .box { fill: #fff; stroke: #cbd5e0; stroke-width: 2; }
      .attacker-box { fill: #fef3c7; stroke: #f59e0b; stroke-width: 2; }
      .agent-box { fill: #dbeafe; stroke: #3b82f6; stroke-width: 2; }
      .trace-box { fill: #f3e8ff; stroke: #8b5cf6; stroke-width: 2; }
      .component { fill: #f7fafc; stroke: #cbd5e0; stroke-width: 1.5; rx: 4; }
      .trace-span { fill: #fef3e7; stroke: #f59e0b; stroke-width: 1; rx: 2; }
      .step-circle { fill: #3b82f6; stroke: none; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#4a5568" />
    </marker>
    <marker id="arrowhead-feedback" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#059669" />
    </marker>
  </defs>

  <!-- Step 1: Attack Strategy -->
  <rect x="50" y="70" width="180" height="100" class="attacker-box" rx="8"/>
  <circle cx="70" cy="90" r="12" class="step-circle"/>
  <text x="70" y="95" text-anchor="middle" class="step-number">1</text>
  <text x="140" y="95" text-anchor="middle" class="label">Attack Strategy</text>
  <text x="140" y="115" text-anchor="middle" class="sublabel">Generates adversarial</text>
  <text x="140" y="130" text-anchor="middle" class="sublabel">prompts</text>
  <text x="140" y="155" text-anchor="middle" class="trace-text" style="fill: #059669; font-weight: 600;">‚Üê Uses trace feedback</text>

  <!-- Arrow: Attack to Agent -->
  <path d="M 230 120 L 330 120" class="arrow"/>
  <text x="280" y="110" text-anchor="middle" class="sublabel" style="font-size: 11px;">Attack Prompt</text>

  <!-- Step 2: Agent System -->
  <rect x="330" y="70" width="220" height="180" class="agent-box" rx="8"/>
  <circle cx="350" cy="90" r="12" class="step-circle"/>
  <text x="350" y="95" text-anchor="middle" class="step-number">2</text>
  <text x="440" y="95" text-anchor="middle" class="label">Agent System</text>

  <!-- Agent Components -->
  <rect x="345" y="110" width="190" height="30" class="component"/>
  <text x="350" y="130" class="sublabel">ü§ñ LLM Processing</text>

  <rect x="345" y="145" width="190" height="30" class="component"/>
  <text x="350" y="165" class="sublabel">üõ°Ô∏è Guardrails</text>

  <rect x="345" y="180" width="190" height="30" class="component"/>
  <text x="350" y="200" class="sublabel">üîß Tool Execution</text>

  <rect x="345" y="215" width="190" height="30" class="component"/>
  <text x="350" y="235" class="sublabel">üí¨ Response</text>

  <!-- Trace emissions -->
  <g opacity="0.6">
    <path d="M 345 125 L 270 280" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="2,2"/>
    <path d="M 345 160 L 270 290" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="2,2"/>
    <path d="M 345 195 L 270 300" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="2,2"/>
    <circle cx="270" cy="285" r="3" fill="#8b5cf6"/>
    <circle cx="270" cy="295" r="3" fill="#8b5cf6"/>
    <circle cx="270" cy="305" r="3" fill="#8b5cf6"/>
  </g>

  <!-- Step 3: OTLP Traces -->
  <rect x="50" y="270" width="430" height="150" class="trace-box" rx="8"/>
  <circle cx="70" cy="290" r="12" class="step-circle"/>
  <text x="70" y="295" text-anchor="middle" class="step-number">3</text>
  <text x="265" y="295" text-anchor="middle" class="label">OpenTelemetry Traces Captured</text>

  <!-- Trace spans visualization -->
  <g transform="translate(70, 310)">
    <rect x="0" y="0" width="390" height="18" class="trace-span"/>
    <text x="5" y="13" class="trace-text">[120ms] guardrail.check | decision=blocked</text>
  </g>
  <g transform="translate(70, 333)">
    <rect x="0" y="0" width="390" height="18" class="trace-span"/>
    <text x="5" y="13" class="trace-text">[890ms] tool.database_query | tool=user_search</text>
  </g>
  <g transform="translate(70, 356)">
    <rect x="0" y="0" width="390" height="18" class="trace-span"/>
    <text x="5" y="13" class="trace-text">[15ms] guardrail.output_check | ERROR: Rate limit</text>
  </g>
  <g transform="translate(70, 379)">
    <rect x="0" y="0" width="390" height="18" class="trace-span"/>
    <text x="5" y="13" class="trace-text">[230ms] agent.response | model=gpt-4</text>
  </g>

  <!-- Step 4: Trace Analysis -->
  <rect x="520" y="270" width="230" height="150" class="box" rx="8"/>
  <circle cx="540" cy="290" r="12" class="step-circle"/>
  <text x="540" y="295" text-anchor="middle" class="step-number">4</text>
  <text x="635" y="295" text-anchor="middle" class="label">Trace Analysis</text>

  <text x="530" y="320" class="sublabel" style="font-weight: 600;">Key Observations:</text>
  <text x="530" y="340" class="trace-text">‚Ä¢ Guardrail blocked output</text>
  <text x="530" y="355" class="trace-text">‚Ä¢ Rate limit error detected</text>
  <text x="530" y="370" class="trace-text">‚Ä¢ Tool: user_search called</text>
  <text x="530" y="385" class="trace-text">‚Ä¢ Model: gpt-4 used</text>
  <text x="530" y="400" class="trace-text">‚Ä¢ Total duration: 1.2s</text>

  <!-- Arrow: Traces to Analysis -->
  <path d="M 480 345 L 520 345" class="arrow"/>

  <!-- Feedback Loop - arrow routes around right side to avoid overlap -->
  <path d="M 750 345 L 770 345 Q 780 345, 780 335 L 780 50 Q 780 40, 770 40 L 150 40 Q 140 40, 140 50 L 140 70" class="feedback-arrow"/>

  <!-- Feedback annotation -->
  <text x="400" y="25" text-anchor="middle" class="sublabel" style="fill: #059669; font-weight: 600;">Trace Intelligence Feedback</text>
</svg>
