import React, { useState } from 'react';
import HarmfulPluginsTable from './HarmfulPluginsTable';
import MisinformationPluginsTable from './MisinformationPluginsTable';
import PluginsTable from './PluginsTable';
import PrivacyPluginsTable from './PrivacyPluginsTable';
import SecurityPluginsTable from './SecurityPluginsTable';

const VulnerabilityDropdown = () => {
  const [openSections, setOpenSections] = useState<Set<string>>(new Set(['security']));

  const toggleSection = (section: string) => {
    setOpenSections((prev) => {
      const newSections = new Set(prev);
      if (newSections.has(section)) {
        newSections.delete(section);
      } else {
        newSections.add(section);
      }
      return newSections;
    });
  };

  const renderSection = (
    title: string,
    id: string,
    description: string,
    Component: React.ComponentType,
  ) => (
    <div key={id}>
      <h3
        id={`vulnerability-${id}`}
        onClick={() => toggleSection(id)}
        style={{ cursor: 'pointer' }}
      >
        <a href={`#vulnerability-${id}`} style={{ textDecoration: 'none', color: 'inherit' }}>
          {title} {openSections.has(id) ? '▼' : '▶'}
        </a>
      </h3>
      <p>{description}</p>
      {openSections.has(id) && <Component />}
    </div>
  );

  const sections = [
    {
      title: 'Security Vulnerabilities',
      id: 'security',
      description:
        'Technical security risks including injection attacks, broken access control, and prompt leaks.',
      component: SecurityPluginsTable,
    },
    {
      title: 'Privacy Violations',
      id: 'privacy',
      description: 'Risks related to personal data exposure and privacy breaches.',
      component: PrivacyPluginsTable,
    },
    {
      title: 'Criminal Activities',
      id: 'criminal',
      description: 'Content related to illegal activities and criminal behavior.',
      component: () => <PluginsTable vulnerabilityType="criminal" />,
    },
    {
      title: 'Harmful Content',
      id: 'harmful',
      description: 'Content that could cause harm or distress to users.',
      component: HarmfulPluginsTable,
    },
    {
      title: 'Misinformation and Misuse',
      id: 'misinformation',
      description: 'False information, hallucinations, and model misuse.',
      component: MisinformationPluginsTable,
    },
  ];

  return (
    <div>
      {sections.map((section) =>
        renderSection(section.title, section.id, section.description, section.component),
      )}
    </div>
  );
};

export default VulnerabilityDropdown;
