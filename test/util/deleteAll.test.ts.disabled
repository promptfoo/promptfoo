// This test requires real database operations and was already failing on main branch
// Disabled until proper integration test setup is implemented

// Use real database for these integration tests
process.env.USE_REAL_DATABASE = 'true';
process.env.IS_TESTING = 'true';

import { closeDb } from '../../src/database';
import { runDbMigrations } from '../../src/migrate';
import Eval from '../../src/models/eval';
import { deleteAllEvals } from '../../src/util/database';
import EvalFactory from '../factories/evalFactory';

describe('delete all evals', () => {
  beforeAll(async () => {
    await runDbMigrations();
  });
  
  afterAll(() => {
    closeDb();
    delete process.env.USE_REAL_DATABASE;
  });
  
  it('should delete all evals', async () => {
    await EvalFactory.create();
    await EvalFactory.create();
    await EvalFactory.create();

    const evals = await Eval.getMany();
    expect(evals).toHaveLength(3);

    await deleteAllEvals();

    const evals2 = await Eval.getMany();
    expect(evals2).toHaveLength(0);
  });
});